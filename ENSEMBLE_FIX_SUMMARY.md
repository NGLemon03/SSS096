# SSS_EnsembleTab.py ä¿®å¤æ€»ç»“

## é—®é¢˜æè¿°

æ ¹æ®ç”¨æˆ·åé¦ˆï¼ŒSSSï¼ˆstreamlitï¼‰å’Œapp_dash.pyä¹‹é—´å­˜åœ¨ensembleå‚æ•°ä¸ä¸€è‡´çš„é—®é¢˜ï¼š

1. **å‚æ•°ä¸ä¸€è‡´**ï¼š
   - SSSä½¿ç”¨æ—§å‚æ•°ï¼š`majority_k=6`ã€`min_cooldown_days=3`ã€`buy_fee_bp/sell_fee_bp=15.0`
   - appä½¿ç”¨æ–°å‚æ•°ï¼š`majority_k_pct=0.55`ã€`min_cooldown_days=1`ã€`buy_fee_bp/sell_fee_bp=4.27`

2. **è·¯å¾„å†²çª**ï¼š
   - SSS_EnsembleTab.pyä¸­å­˜åœ¨é‡å¤çš„æ¨¡å—å¤´ï¼Œå¯¼è‡´è·¯å¾„å¸¸é‡äº’ç›¸å†²çª
   - å¯èƒ½è¯»å–åˆ°é”™è¯¯ä½ç½®çš„ä»·é‡CSVæ–‡ä»¶

## ä¿®å¤å†…å®¹

### 1. æ¸…ç†é‡å¤æ¨¡å—å¤´ âœ…
- åˆ é™¤äº†é‡å¤çš„æ¨¡å—å¤´å®šä¹‰
- ç¡®ä¿åªæœ‰ä¸€ä»½æ­£ç¡®çš„è·¯å¾„å¸¸é‡å®šä¹‰ï¼š
  ```python
  BASE_DIR = Path(os.path.dirname(os.path.abspath(__file__)))
  DATA_DIR = BASE_DIR / "data"
  OUT_DIR = BASE_DIR / "sss_backtest_outputs"
  ```

### 2. æ›´æ–°é»˜è®¤å‚æ•° âœ…
- æ›´æ–°`EnsembleParams`é»˜è®¤å€¼ä»¥åŒ¹é…`param_presets`ï¼š
  ```python
  min_cooldown_days: int = 1  # ä¸param_presetsä¸€è‡´
  min_trade_dw: float = 0.01  # ä¸param_presetsä¸€è‡´
  ```

### 3. å¼ºåˆ¶ä½¿ç”¨æ¯”ä¾‹é—¨æ§› âœ…
- åœ¨`main()`å‡½æ•°ä¸­å¼ºåˆ¶è®¾ç½®`majority_k_pct = 0.55`
- ç¡®ä¿ä¸app_dash.pyçš„é…ç½®ä¿æŒä¸€è‡´

### 4. ä¼˜å…ˆä½¿ç”¨æ–°ç­–ç•¥æ–‡ä»¶ âœ…
- ä¿®æ”¹ç­–ç•¥æ–‡ä»¶æ‰«æé€»è¾‘ï¼Œä¼˜å…ˆä½¿ç”¨`trades_from_results_*.csv`ï¼ˆ120æ¡£ç­–ç•¥ï¼‰
- æ‰¾ä¸åˆ°æ—¶æ‰ä½¿ç”¨æ—§çš„`trades_*.csv`ï¼ˆ11æ¡£ç­–ç•¥ï¼‰

### 5. æ›´æ–°æˆæœ¬å‚æ•° âœ…
- æ›´æ–°`CostParams`é»˜è®¤å€¼ï¼š
  ```python
  buy_fee_bp: float = 4.27   # ä¸param_presetsä¸€è‡´
  sell_fee_bp: float = 4.27  # ä¸param_presetsä¸€è‡´
  sell_tax_bp: float = 30.0  # ä¸param_presetsä¸€è‡´
  ```

## ä¿®å¤åçš„é…ç½®å¯¹æ¯”

| å‚æ•° | ä¿®å¤å‰ | ä¿®å¤å | è¯´æ˜ |
|------|--------|--------|------|
| `majority_k` | 6 | 6 | ä»…åœ¨æ²¡æœ‰`majority_k_pct`æ—¶ä½¿ç”¨ |
| `majority_k_pct` | æ—  | 0.55 | å¼ºåˆ¶ä½¿ç”¨æ¯”ä¾‹é—¨æ§› |
| `min_cooldown_days` | 3 | 1 | ä¸param_presetsä¸€è‡´ |
| `min_trade_dw` | 0.01 | 0.01 | ä¸param_presetsä¸€è‡´ |
| `buy_fee_bp` | 15.0 | 4.27 | ä¸param_presetsä¸€è‡´ |
| `sell_fee_bp` | 15.0 | 4.27 | ä¸param_presetsä¸€è‡´ |
| `sell_tax_bp` | 30.0 | 30.0 | ä¿æŒä¸å˜ |
| ç­–ç•¥æ–‡ä»¶ä¼˜å…ˆçº§ | `trades_*.csv` | `trades_from_results_*.csv` | ä¼˜å…ˆä½¿ç”¨120æ¡£ç­–ç•¥ |

## éªŒè¯ç»“æœ

è¿è¡Œæµ‹è¯•è„šæœ¬`test_ensemble_fix.py`çš„ç»“æœï¼š

```
============================================================
æµ‹è¯•ç»“æœ: 4/4 é€šè¿‡
ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼SSS_EnsembleTab.py ä¿®å¤æˆåŠŸ

ä¿®å¤å†…å®¹æ€»ç»“:
1. âœ“ æ¸…ç†äº†é‡å¤çš„æ¨¡å—å¤´
2. âœ“ æ›´æ–°äº†é»˜è®¤å‚æ•°ä»¥åŒ¹é…param_presets
3. âœ“ å¼ºåˆ¶ä½¿ç”¨majority_k_pct=0.55
4. âœ“ ä¼˜å…ˆä½¿ç”¨trades_from_results_*.csvæ–‡ä»¶
5. âœ“ ä½¿ç”¨æ­£ç¡®çš„æˆæœ¬å‚æ•°ï¼ˆ4.27 bp + 30 bpç¨ï¼‰
6. âœ“ ä½¿ç”¨æ­£ç¡®çš„å†·å´å’Œå¾®è°ƒå‚æ•°ï¼ˆcooldown=1, min_trade_dw=0.01/0.03ï¼‰
```

## é¢„æœŸæ•ˆæœ

ä¿®å¤åï¼ŒSSSå’Œapp_dash.pyçš„ensembleç­–ç•¥åº”è¯¥ï¼š

1. **å‚æ•°ä¸€è‡´**ï¼šéƒ½ä½¿ç”¨`majority_k_pct=0.55`ã€`min_cooldown_days=1`ã€æˆæœ¬4.27bp
2. **ç­–ç•¥æ•°é‡ä¸€è‡´**ï¼šéƒ½ä½¿ç”¨120æ¡£ç­–ç•¥ï¼ˆ`trades_from_results_*.csv`ï¼‰
3. **æƒç›Šæ›²çº¿ä¸€è‡´**ï¼šè¯»å–ç›¸åŒä½ç½®çš„ä»·é‡CSVï¼Œä½¿ç”¨ç›¸åŒçš„å‚æ•°é…ç½®
4. **æ—¥å¿—æ˜¾ç¤ºä¸€è‡´**ï¼šæ˜¾ç¤ºç›¸åŒçš„ç­–ç•¥æ•°é‡ã€é—¨æ§›ã€æˆæœ¬ç­‰ä¿¡æ¯

## ä½¿ç”¨å»ºè®®

1. **æµ‹è¯•éªŒè¯**ï¼šè¿è¡ŒSSSå’Œapp_dash.pyçš„ensembleç­–ç•¥ï¼Œå¯¹æ¯”ç»“æœæ˜¯å¦ä¸€è‡´
2. **æ—¥å¿—æ£€æŸ¥**ï¼šç¡®è®¤æ—¥å¿—æ˜¾ç¤ºï¼š
   - ç­–ç•¥æ•°é‡ï¼š~120ï¼ˆä¸æ˜¯11ï¼‰
   - é—¨æ§›ï¼š`majority_k_pct=0.55`
   - æˆæœ¬ï¼š`buy_fee_bp=4.27`ã€`sell_fee_bp=4.27`ã€`sell_tax_bp=30`
   - å†·å´ï¼š`min_cooldown_days=1`
   - æ•°æ®è·¯å¾„ï¼š`.../data/00631L.TW_data_raw.csv`

3. **å‚æ•°è°ƒæ•´**ï¼šå¦‚éœ€ä¿®æ”¹ensembleå‚æ•°ï¼Œå»ºè®®åœ¨`SSSv096.py`çš„`param_presets`ä¸­è°ƒæ•´ï¼Œç¡®ä¿ä¸¤è¾¹çš„é…ç½®åŒæ­¥

## æ–‡ä»¶æ¸…å•

- `SSS_EnsembleTab.py` - ä¸»è¦ä¿®å¤æ–‡ä»¶
- `test_ensemble_fix.py` - éªŒè¯æµ‹è¯•è„šæœ¬
- `ENSEMBLE_FIX_SUMMARY.md` - æœ¬ä¿®å¤æ€»ç»“æ–‡æ¡£
