2025-08-23 00:22:01 INFO [SSS.App:35] === App Dash 啟動 - 統一日誌系統 ===
2025-08-23 00:22:01 INFO [SSS.App:36] 已啟用詳細調試模式 - 調試資訊將寫入日誌檔案
2025-08-23 00:22:01 INFO [SSS.App:37] 日誌目錄: C:\Stock_reserach\SSS096\analysis\log
2025-08-23 00:22:05 INFO [SSS.App:620] === 風險閥門狀態更新 ===
2025-08-23 00:22:05 INFO [SSS.App:621] global_apply: False
2025-08-23 00:22:05 INFO [SSS.App:622] risk_cap: 0.3
2025-08-23 00:22:06 INFO [SSS.App:623] atr_ratio: 1
2025-08-23 00:22:06 INFO [SSS.App:624] force_trigger: False
2025-08-23 00:22:06 DEBUG [SSS.App:805] run_backtest 被調用 - n_clicks: 0, auto_run: True, trigger: None
2025-08-23 00:22:06 INFO [SSS.App:625] ticker: 00631L.TW
2025-08-23 00:22:06 INFO [SSS.App:626] start_date: 2010-01-01
2025-08-23 00:22:06 INFO [SSS.App:627] end_date: 
2025-08-23 00:22:06 INFO [SSS.App:630] 風險閥門未啟用
2025-08-23 00:22:06 DEBUG [SSS.App:805] run_backtest 被調用 - n_clicks: 0, auto_run: True, trigger: {'param': 'linlen', 'type': 'param-input'}
2025-08-23 00:22:06 INFO [SSS.App:826] 開始執行回測 - ticker: 00631L.TW, 策略數: 13
2025-08-23 00:22:06 INFO [SSS.App:843] [Single 2] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:22:06 INFO [SSS.App:888] [Single 2] 未啟用全局風險閥門
2025-08-23 00:22:06 INFO [SSS.App:843] [single_1887] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:22:06 INFO [SSS.App:888] [single_1887] 未啟用全局風險閥門
2025-08-23 00:22:07 INFO [SSS.App:843] [Single 3] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:22:07 INFO [SSS.App:888] [Single 3] 未啟用全局風險閥門
2025-08-23 00:22:07 INFO [SSS.App:843] [RMA_69] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:22:07 INFO [SSS.App:888] [RMA_69] 未啟用全局風險閥門
2025-08-23 00:22:08 INFO [SSS.App:843] [RMA_669] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:22:08 INFO [SSS.App:888] [RMA_669] 未啟用全局風險閥門
2025-08-23 00:22:08 INFO [SSS.App:843] [STM0] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:22:08 INFO [SSS.App:888] [STM0] 未啟用全局風險閥門
2025-08-23 00:22:09 INFO [SSS.App:843] [STM1] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:22:09 INFO [SSS.App:888] [STM1] 未啟用全局風險閥門
2025-08-23 00:22:09 INFO [SSS.App:620] === 風險閥門狀態更新 ===
2025-08-23 00:22:09 DEBUG [SSS.App:805] run_backtest 被調用 - n_clicks: 0, auto_run: True, trigger: global-apply-switch
2025-08-23 00:22:09 INFO [SSS.App:621] global_apply: True
2025-08-23 00:22:09 INFO [SSS.App:622] risk_cap: 0.3
2025-08-23 00:22:09 INFO [SSS.App:623] atr_ratio: 1
2025-08-23 00:22:09 INFO [SSS.App:624] force_trigger: False
2025-08-23 00:22:09 INFO [SSS.App:625] ticker: 00631L.TW
2025-08-23 00:22:09 INFO [SSS.App:626] start_date: 2010-01-01
2025-08-23 00:22:09 INFO [SSS.App:627] end_date: 
2025-08-23 00:22:09 INFO [SSS.App:640] 開始載入數據: ticker=00631L.TW, start_date=2010-01-01, end_date=
2025-08-23 00:22:09 INFO [SSS.App:826] 開始執行回測 - ticker: 00631L.TW, 策略數: 13
2025-08-23 00:22:09 INFO [SSS.App:642] 數據載入結果: 空=False, 形狀=(2643, 5)
2025-08-23 00:22:09 INFO [SSS.App:646] 開始計算 ATR 比值
2025-08-23 00:22:09 INFO [SSS.App:843] [Single 2] 風險閥門開關狀態: global_apply=True, 類型=<class 'bool'>
2025-08-23 00:22:09 INFO [SSS.App:845] [Single 2] 應用全局風險閥門: CAP=0.3, ATR比值門檻=1
2025-08-23 00:22:09 INFO [SSS.App:649] ATR 計算完成: atr_20=<class 'pandas.core.series.Series'>, atr_60=<class 'pandas.core.series.Series'>
2025-08-23 00:22:09 INFO [SSS.App:876] [Single 2] 最新ATR比值: 1.1129 (20期:5.9575, 60期:5.3533)
2025-08-23 00:22:09 INFO [SSS.App:696] ATR 比值計算: 5.957500 / 5.353334 = 1.1129
2025-08-23 00:22:09 INFO [SSS.App:697] 風險閥門門檻: 1, 當前比值: 1.1129
2025-08-23 00:22:09 INFO [SSS.App:698] 風險閥門觸發: 是
2025-08-23 00:22:09 INFO [SSS.App:699] 風險閥門狀態: 🔴 觸發
2025-08-23 00:22:11 INFO [SSS.App:843] [STM3] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:22:11 INFO [SSS.App:888] [STM3] 未啟用全局風險閥門
2025-08-23 00:22:11 INFO [SSS.App:1312] [Single 2] 進階分析風險閥門：斜率條件啟用，ATR比值門檻=1
2025-08-23 00:22:11 INFO [SSS.App:1392] [Single 2] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.0
2025-08-23 00:22:13 INFO [SSS.App:1401] [UI_CHECK] 即將覆寫：new_trades=84 rows, new_ds=2467 rows
2025-08-23 00:22:13 INFO [SSS.App:1502] [Single 2] 全局風險閥門已套用（逐日），風險天數=235, CAP=0.30
2025-08-23 00:22:13 INFO [SSS.App:843] [single_1887] 風險閥門開關狀態: global_apply=True, 類型=<class 'bool'>
2025-08-23 00:22:13 INFO [SSS.App:845] [single_1887] 應用全局風險閥門: CAP=0.3, ATR比值門檻=1
2025-08-23 00:22:13 INFO [SSS.App:876] [single_1887] 最新ATR比值: 1.1129 (20期:5.9575, 60期:5.3533)
2025-08-23 00:22:14 INFO [SSS.App:843] [STM4] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:22:14 INFO [SSS.App:888] [STM4] 未啟用全局風險閥門
2025-08-23 00:22:15 INFO [SSS.App:1312] [single_1887] 進階分析風險閥門：斜率條件啟用，ATR比值門檻=1
2025-08-23 00:22:15 INFO [SSS.App:1392] [single_1887] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.0
2025-08-23 00:22:16 INFO [SSS.App:1401] [UI_CHECK] 即將覆寫：new_trades=82 rows, new_ds=2467 rows
2025-08-23 00:22:16 INFO [SSS.App:1502] [single_1887] 全局風險閥門已套用（逐日），風險天數=235, CAP=0.30
2025-08-23 00:22:16 INFO [SSS.App:843] [Single 3] 風險閥門開關狀態: global_apply=True, 類型=<class 'bool'>
2025-08-23 00:22:16 INFO [SSS.App:845] [Single 3] 應用全局風險閥門: CAP=0.3, ATR比值門檻=1
2025-08-23 00:22:16 INFO [SSS.App:876] [Single 3] 最新ATR比值: 1.1129 (20期:5.9575, 60期:5.3533)
2025-08-23 00:22:17 INFO [SSS.App:843] [STM_1939] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:22:17 INFO [SSS.App:888] [STM_1939] 未啟用全局風險閥門
2025-08-23 00:22:18 INFO [SSS.App:1312] [Single 3] 進階分析風險閥門：斜率條件啟用，ATR比值門檻=1
2025-08-23 00:22:18 INFO [SSS.App:1392] [Single 3] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.0
2025-08-23 00:22:19 INFO [SSS.App:1401] [UI_CHECK] 即將覆寫：new_trades=74 rows, new_ds=2467 rows
2025-08-23 00:22:19 INFO [SSS.App:1502] [Single 3] 全局風險閥門已套用（逐日），風險天數=235, CAP=0.30
2025-08-23 00:22:19 INFO [SSS.App:843] [RMA_69] 風險閥門開關狀態: global_apply=True, 類型=<class 'bool'>
2025-08-23 00:22:19 INFO [SSS.App:845] [RMA_69] 應用全局風險閥門: CAP=0.3, ATR比值門檻=1
2025-08-23 00:22:19 INFO [SSS.App:876] [RMA_69] 最新ATR比值: 1.1129 (20期:5.9575, 60期:5.3533)
2025-08-23 00:22:20 INFO [SSS.App:1312] [RMA_69] 進階分析風險閥門：斜率條件啟用，ATR比值門檻=1
2025-08-23 00:22:21 INFO [SSS.App:1392] [RMA_69] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.0
2025-08-23 00:22:22 INFO [SSS.App:843] [STM_2414_273] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:22:22 INFO [SSS.App:888] [STM_2414_273] 未啟用全局風險閥門
2025-08-23 00:22:22 INFO [SSS.App:1401] [UI_CHECK] 即將覆寫：new_trades=45 rows, new_ds=2268 rows
2025-08-23 00:22:22 INFO [SSS.App:1502] [RMA_69] 全局風險閥門已套用（逐日），風險天數=202, CAP=0.30
2025-08-23 00:22:22 INFO [SSS.App:843] [RMA_669] 風險閥門開關狀態: global_apply=True, 類型=<class 'bool'>
2025-08-23 00:22:22 INFO [SSS.App:845] [RMA_669] 應用全局風險閥門: CAP=0.3, ATR比值門檻=1
2025-08-23 00:22:22 INFO [SSS.App:876] [RMA_669] 最新ATR比值: 1.1129 (20期:5.9575, 60期:5.3533)
2025-08-23 00:22:23 INFO [SSS.App:1312] [RMA_669] 進階分析風險閥門：斜率條件啟用，ATR比值門檻=1
2025-08-23 00:22:23 INFO [SSS.App:1392] [RMA_669] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.0
2025-08-23 00:22:25 INFO [SSS.App:1401] [UI_CHECK] 即將覆寫：new_trades=44 rows, new_ds=2261 rows
2025-08-23 00:22:25 INFO [SSS.App:1502] [RMA_669] 全局風險閥門已套用（逐日），風險天數=202, CAP=0.30
2025-08-23 00:22:25 INFO [SSS.App:843] [STM0] 風險閥門開關狀態: global_apply=True, 類型=<class 'bool'>
2025-08-23 00:22:25 INFO [SSS.App:845] [STM0] 應用全局風險閥門: CAP=0.3, ATR比值門檻=1
2025-08-23 00:22:25 INFO [SSS.App:876] [STM0] 最新ATR比值: 1.1129 (20期:5.9575, 60期:5.3533)
2025-08-23 00:22:25 INFO [SSS.App:969] [Global] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.1128579330783364
2025-08-23 00:22:27 INFO [SSS.App:843] [Ensemble_Majority] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:22:27 INFO [SSS.App:888] [Ensemble_Majority] 未啟用全局風險閥門
2025-08-23 00:22:27 INFO [SSS.App:987] [STM0] SSMA 風險閥門已套用（cap=0.3, ratio=1.1129）
2025-08-23 00:22:27 INFO [SSS.App:1062] [Ensemble] 強制設定 majority_k_pct=0.55
2025-08-23 00:22:27 INFO [SSS.App:1064] [Ensemble] 執行配置: ticker=00631L.TW, method=majority, majority_k_pct=N/A
2025-08-23 00:22:27 INFO [SSS.App:1074] [Ensemble_Majority] Ensemble ATR 計算: atr_20=<class 'pandas.core.series.Series'>, atr_60=<class 'pandas.core.series.Series'>
2025-08-23 00:22:27 INFO [SSS.App:1080] [Ensemble_Majority] Ensemble ATR 有效值: atr_20=2624, atr_60=2584
2025-08-23 00:22:27 INFO [SSS.App:1086] [Ensemble_Majority] Ensemble ATR 最新值: a20=5.957500, a60=5.353334
2025-08-23 00:22:27 INFO [SSS.App:1091] [Ensemble_Majority] Ensemble ATR 比值: 1.1129 (門檻=1) -> 觸發=True
2025-08-23 00:22:27 INFO [SSS.App:1095] [Ensemble_Majority] 🔴 風險閥門觸發！ATR比值(1.1129) > 門檻(1)
2025-08-23 00:22:27 INFO [SSS.App:1312] [STM0] 進階分析風險閥門：斜率條件啟用，ATR比值門檻=1
2025-08-23 00:22:27 INFO [SSS.App:1392] [STM0] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.0
2025-08-23 00:22:29 INFO [SSS.App:1401] [UI_CHECK] 即將覆寫：new_trades=68 rows, new_ds=2643 rows
2025-08-23 00:22:29 INFO [SSS.App:1502] [STM0] 全局風險閥門已套用（逐日），風險天數=247, CAP=0.30
2025-08-23 00:22:29 INFO [SSS.App:843] [STM1] 風險閥門開關狀態: global_apply=True, 類型=<class 'bool'>
2025-08-23 00:22:29 INFO [SSS.App:845] [STM1] 應用全局風險閥門: CAP=0.3, ATR比值門檻=1
2025-08-23 00:22:29 INFO [SSS.App:876] [STM1] 最新ATR比值: 1.1129 (20期:5.9575, 60期:5.3533)
2025-08-23 00:22:29 INFO [SSS.App:969] [Global] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.1128579330783364
2025-08-23 00:22:30 INFO [SSS.App:987] [STM1] SSMA 風險閥門已套用（cap=0.3, ratio=1.1129）
2025-08-23 00:22:31 INFO [SSS.App:1312] [STM1] 進階分析風險閥門：斜率條件啟用，ATR比值門檻=1
2025-08-23 00:22:31 INFO [SSS.App:1392] [STM1] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.0
2025-08-23 00:22:32 INFO [SSS.App:1401] [UI_CHECK] 即將覆寫：new_trades=60 rows, new_ds=2643 rows
2025-08-23 00:22:32 INFO [SSS.App:1502] [STM1] 全局風險閥門已套用（逐日），風險天數=247, CAP=0.30
2025-08-23 00:22:32 INFO [SSS.App:843] [STM3] 風險閥門開關狀態: global_apply=True, 類型=<class 'bool'>
2025-08-23 00:22:32 INFO [SSS.App:845] [STM3] 應用全局風險閥門: CAP=0.3, ATR比值門檻=1
2025-08-23 00:22:32 INFO [SSS.App:876] [STM3] 最新ATR比值: 1.1129 (20期:5.9575, 60期:5.3533)
2025-08-23 00:22:33 INFO [SSS.App:969] [Global] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.1128579330783364
2025-08-23 00:22:34 INFO [SSS.App:987] [STM3] SSMA 風險閥門已套用（cap=0.3, ratio=1.1129）
2025-08-23 00:22:34 INFO [SSS.App:1312] [STM3] 進階分析風險閥門：斜率條件啟用，ATR比值門檻=1
2025-08-23 00:22:34 INFO [SSS.App:1392] [STM3] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.0
2025-08-23 00:22:36 INFO [SSS.App:1401] [UI_CHECK] 即將覆寫：new_trades=67 rows, new_ds=2643 rows
2025-08-23 00:22:36 INFO [SSS.App:1502] [STM3] 全局風險閥門已套用（逐日），風險天數=247, CAP=0.30
2025-08-23 00:22:36 INFO [SSS.App:843] [STM4] 風險閥門開關狀態: global_apply=True, 類型=<class 'bool'>
2025-08-23 00:22:36 INFO [SSS.App:845] [STM4] 應用全局風險閥門: CAP=0.3, ATR比值門檻=1
2025-08-23 00:22:36 INFO [SSS.App:876] [STM4] 最新ATR比值: 1.1129 (20期:5.9575, 60期:5.3533)
2025-08-23 00:22:36 INFO [SSS.App:969] [Global] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.1128579330783364
2025-08-23 00:22:37 INFO [SSS.App:987] [STM4] SSMA 風險閥門已套用（cap=0.3, ratio=1.1129）
2025-08-23 00:22:38 INFO [SSS.App:1312] [STM4] 進階分析風險閥門：斜率條件啟用，ATR比值門檻=1
2025-08-23 00:22:38 INFO [SSS.App:1392] [STM4] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.0
2025-08-23 00:22:39 INFO [SSS.App:1401] [UI_CHECK] 即將覆寫：new_trades=83 rows, new_ds=2643 rows
2025-08-23 00:22:39 INFO [SSS.App:1502] [STM4] 全局風險閥門已套用（逐日），風險天數=247, CAP=0.30
2025-08-23 00:22:39 INFO [SSS.App:843] [STM_1939] 風險閥門開關狀態: global_apply=True, 類型=<class 'bool'>
2025-08-23 00:22:39 INFO [SSS.App:845] [STM_1939] 應用全局風險閥門: CAP=0.3, ATR比值門檻=1
2025-08-23 00:22:39 INFO [SSS.App:876] [STM_1939] 最新ATR比值: 1.1129 (20期:5.9575, 60期:5.3533)
2025-08-23 00:22:40 INFO [SSS.App:969] [Global] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.1128579330783364
2025-08-23 00:22:41 INFO [SSS.App:987] [STM_1939] SSMA 風險閥門已套用（cap=0.3, ratio=1.1129）
2025-08-23 00:22:42 INFO [SSS.App:1312] [STM_1939] 進階分析風險閥門：斜率條件啟用，ATR比值門檻=1
2025-08-23 00:22:42 INFO [SSS.App:1392] [STM_1939] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.0
2025-08-23 00:22:43 INFO [SSS.App:1401] [UI_CHECK] 即將覆寫：new_trades=60 rows, new_ds=2643 rows
2025-08-23 00:22:43 INFO [SSS.App:1502] [STM_1939] 全局風險閥門已套用（逐日），風險天數=247, CAP=0.30
2025-08-23 00:22:43 INFO [SSS.App:843] [STM_2414_273] 風險閥門開關狀態: global_apply=True, 類型=<class 'bool'>
2025-08-23 00:22:43 INFO [SSS.App:845] [STM_2414_273] 應用全局風險閥門: CAP=0.3, ATR比值門檻=1
2025-08-23 00:22:43 INFO [SSS.App:876] [STM_2414_273] 最新ATR比值: 1.1129 (20期:5.9575, 60期:5.3533)
2025-08-23 00:22:44 INFO [SSS.App:969] [Global] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.1128579330783364
2025-08-23 00:22:45 INFO [SSS.App:987] [STM_2414_273] SSMA 風險閥門已套用（cap=0.3, ratio=1.1129）
2025-08-23 00:22:46 INFO [SSS.App:1312] [STM_2414_273] 進階分析風險閥門：斜率條件啟用，ATR比值門檻=1
2025-08-23 00:22:46 INFO [SSS.App:1392] [STM_2414_273] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.0
2025-08-23 00:22:47 INFO [SSS.App:1401] [UI_CHECK] 即將覆寫：new_trades=56 rows, new_ds=2643 rows
2025-08-23 00:22:47 INFO [SSS.App:1502] [STM_2414_273] 全局風險閥門已套用（逐日），風險天數=247, CAP=0.30
2025-08-23 00:22:47 INFO [SSS.App:843] [Ensemble_Majority] 風險閥門開關狀態: global_apply=True, 類型=<class 'bool'>
2025-08-23 00:22:47 INFO [SSS.App:845] [Ensemble_Majority] 應用全局風險閥門: CAP=0.3, ATR比值門檻=1
2025-08-23 00:22:47 INFO [SSS.App:876] [Ensemble_Majority] 最新ATR比值: 1.1129 (20期:5.9575, 60期:5.3533)
2025-08-23 00:22:47 INFO [SSS.App:1062] [Ensemble] 強制設定 majority_k_pct=0.55
2025-08-23 00:22:47 INFO [SSS.App:1064] [Ensemble] 執行配置: ticker=00631L.TW, method=majority, majority_k_pct=N/A
2025-08-23 00:22:47 INFO [SSS.App:1074] [Ensemble_Majority] Ensemble ATR 計算: atr_20=<class 'pandas.core.series.Series'>, atr_60=<class 'pandas.core.series.Series'>
2025-08-23 00:22:47 INFO [SSS.App:1080] [Ensemble_Majority] Ensemble ATR 有效值: atr_20=2624, atr_60=2584
2025-08-23 00:22:47 INFO [SSS.App:1086] [Ensemble_Majority] Ensemble ATR 最新值: a20=5.957500, a60=5.353334
2025-08-23 00:22:47 INFO [SSS.App:1091] [Ensemble_Majority] Ensemble ATR 比值: 1.1129 (門檻=1) -> 觸發=True
2025-08-23 00:22:47 INFO [SSS.App:1095] [Ensemble_Majority] 🔴 風險閥門觸發！ATR比值(1.1129) > 門檻(1)
2025-08-23 00:22:50 INFO [SSS.App:1171] [Ensemble_Majority] ⚪ 全局風險閥門未啟用
2025-08-23 00:22:50 INFO [SSS.App:1196] [Ensemble] 執行成功: 權益曲線長度=2643, 交易數=217
2025-08-23 00:22:50 INFO [SSS.App:1211] [Ensemble] 執行完成，ticker=00631L.TW, method=majority
2025-08-23 00:22:50 INFO [SSS.App:843] [Ensemble_Proportional] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:22:50 INFO [SSS.App:888] [Ensemble_Proportional] 未啟用全局風險閥門
2025-08-23 00:22:50 INFO [SSS.App:1062] [Ensemble] 強制設定 majority_k_pct=0.55
2025-08-23 00:22:50 INFO [SSS.App:1064] [Ensemble] 執行配置: ticker=00631L.TW, method=proportional, majority_k_pct=N/A
2025-08-23 00:22:50 INFO [SSS.App:1074] [Ensemble_Proportional] Ensemble ATR 計算: atr_20=<class 'pandas.core.series.Series'>, atr_60=<class 'pandas.core.series.Series'>
2025-08-23 00:22:50 INFO [SSS.App:1080] [Ensemble_Proportional] Ensemble ATR 有效值: atr_20=2624, atr_60=2584
2025-08-23 00:22:50 INFO [SSS.App:1086] [Ensemble_Proportional] Ensemble ATR 最新值: a20=5.957500, a60=5.353334
2025-08-23 00:22:50 INFO [SSS.App:1091] [Ensemble_Proportional] Ensemble ATR 比值: 1.1129 (門檻=1) -> 觸發=True
2025-08-23 00:22:50 INFO [SSS.App:1095] [Ensemble_Proportional] 🔴 風險閥門觸發！ATR比值(1.1129) > 門檻(1)
2025-08-23 00:22:50 INFO [SSS.App:826] 開始執行回測 - ticker: 00631L.TW, 策略數: 13
2025-08-23 00:22:50 INFO [SSS.App:843] [Single 2] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:22:50 INFO [SSS.App:888] [Single 2] 未啟用全局風險閥門
2025-08-23 00:22:51 INFO [SSS.App:843] [single_1887] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:22:51 INFO [SSS.App:888] [single_1887] 未啟用全局風險閥門
2025-08-23 00:22:51 INFO [SSS.App:843] [Single 3] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:22:51 INFO [SSS.App:888] [Single 3] 未啟用全局風險閥門
2025-08-23 00:22:52 INFO [SSS.App:843] [RMA_69] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:22:52 INFO [SSS.App:888] [RMA_69] 未啟用全局風險閥門
2025-08-23 00:22:52 INFO [SSS.App:843] [RMA_669] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:22:52 INFO [SSS.App:888] [RMA_669] 未啟用全局風險閥門
2025-08-23 00:22:53 INFO [SSS.App:843] [STM0] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:22:53 INFO [SSS.App:888] [STM0] 未啟用全局風險閥門
2025-08-23 00:22:53 INFO [SSS.App:843] [STM1] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:22:53 INFO [SSS.App:888] [STM1] 未啟用全局風險閥門
2025-08-23 00:22:54 INFO [SSS.App:843] [STM3] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:22:54 INFO [SSS.App:888] [STM3] 未啟用全局風險閥門
2025-08-23 00:22:54 INFO [SSS.App:843] [STM4] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:22:54 INFO [SSS.App:888] [STM4] 未啟用全局風險閥門
2025-08-23 00:22:54 INFO [SSS.App:843] [STM_1939] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:22:54 INFO [SSS.App:888] [STM_1939] 未啟用全局風險閥門
2025-08-23 00:22:55 INFO [SSS.App:843] [STM_2414_273] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:22:55 INFO [SSS.App:888] [STM_2414_273] 未啟用全局風險閥門
2025-08-23 00:22:55 INFO [SSS.App:843] [Ensemble_Majority] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:22:55 INFO [SSS.App:888] [Ensemble_Majority] 未啟用全局風險閥門
2025-08-23 00:22:55 INFO [SSS.App:1062] [Ensemble] 強制設定 majority_k_pct=0.55
2025-08-23 00:22:55 INFO [SSS.App:1064] [Ensemble] 執行配置: ticker=00631L.TW, method=majority, majority_k_pct=N/A
2025-08-23 00:22:55 INFO [SSS.App:1074] [Ensemble_Majority] Ensemble ATR 計算: atr_20=<class 'pandas.core.series.Series'>, atr_60=<class 'pandas.core.series.Series'>
2025-08-23 00:22:55 INFO [SSS.App:1080] [Ensemble_Majority] Ensemble ATR 有效值: atr_20=2624, atr_60=2584
2025-08-23 00:22:55 INFO [SSS.App:1086] [Ensemble_Majority] Ensemble ATR 最新值: a20=5.957500, a60=5.353334
2025-08-23 00:22:55 INFO [SSS.App:1091] [Ensemble_Majority] Ensemble ATR 比值: 1.1129 (門檻=1) -> 觸發=True
2025-08-23 00:22:55 INFO [SSS.App:1095] [Ensemble_Majority] 🔴 風險閥門觸發！ATR比值(1.1129) > 門檻(1)
2025-08-23 00:22:57 INFO [SSS.App:1124] [Ensemble_Majority] 🔴 開始套用風險閥門: cap=0.3, ratio=1.1129
2025-08-23 00:22:58 INFO [SSS.App:1145] [Ensemble_Majority] 風險閥門已套用（cap=0.3, ratio=1.1129）
2025-08-23 00:22:58 INFO [SSS.App:1149] [Ensemble_Majority] 風險閥門效果: PF原始=0.75, PF閥門=0.90
2025-08-23 00:22:58 INFO [SSS.App:1150] [Ensemble_Majority] 風險閥門效果: MDD原始=-0.43%, MDD閥門=-0.24%
2025-08-23 00:22:58 INFO [SSS.App:1196] [Ensemble] 執行成功: 權益曲線長度=2643, 交易數=215
2025-08-23 00:22:58 INFO [SSS.App:1211] [Ensemble] 執行完成，ticker=00631L.TW, method=majority
2025-08-23 00:22:59 INFO [SSS.App:1312] [Ensemble_Majority] 進階分析風險閥門：斜率條件啟用，ATR比值門檻=1
2025-08-23 00:22:59 INFO [SSS.App:1392] [Ensemble_Majority] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.0
2025-08-23 00:23:00 INFO [SSS.App:1401] [UI_CHECK] 即將覆寫：new_trades=215 rows, new_ds=2643 rows
2025-08-23 00:23:00 INFO [SSS.App:1502] [Ensemble_Majority] 全局風險閥門已套用（逐日），風險天數=247, CAP=0.30
2025-08-23 00:23:00 INFO [SSS.App:843] [Ensemble_Proportional] 風險閥門開關狀態: global_apply=True, 類型=<class 'bool'>
2025-08-23 00:23:00 INFO [SSS.App:845] [Ensemble_Proportional] 應用全局風險閥門: CAP=0.3, ATR比值門檻=1
2025-08-23 00:23:00 INFO [SSS.App:876] [Ensemble_Proportional] 最新ATR比值: 1.1129 (20期:5.9575, 60期:5.3533)
2025-08-23 00:23:00 INFO [SSS.App:1062] [Ensemble] 強制設定 majority_k_pct=0.55
2025-08-23 00:23:00 INFO [SSS.App:1064] [Ensemble] 執行配置: ticker=00631L.TW, method=proportional, majority_k_pct=N/A
2025-08-23 00:23:00 INFO [SSS.App:1074] [Ensemble_Proportional] Ensemble ATR 計算: atr_20=<class 'pandas.core.series.Series'>, atr_60=<class 'pandas.core.series.Series'>
2025-08-23 00:23:00 INFO [SSS.App:1080] [Ensemble_Proportional] Ensemble ATR 有效值: atr_20=2624, atr_60=2584
2025-08-23 00:23:00 INFO [SSS.App:1086] [Ensemble_Proportional] Ensemble ATR 最新值: a20=5.957500, a60=5.353334
2025-08-23 00:23:00 INFO [SSS.App:1091] [Ensemble_Proportional] Ensemble ATR 比值: 1.1129 (門檻=1) -> 觸發=True
2025-08-23 00:23:00 INFO [SSS.App:1095] [Ensemble_Proportional] 🔴 風險閥門觸發！ATR比值(1.1129) > 門檻(1)
2025-08-23 00:23:03 INFO [SSS.App:1171] [Ensemble_Proportional] ⚪ 全局風險閥門未啟用
2025-08-23 00:23:03 INFO [SSS.App:1196] [Ensemble] 執行成功: 權益曲線長度=2643, 交易數=390
2025-08-23 00:23:03 INFO [SSS.App:1211] [Ensemble] 執行完成，ticker=00631L.TW, method=proportional
2025-08-23 00:23:03 INFO [SSS.App:1529] 回測完成 - 策略數: 13, ticker: 00631L.TW, 數據行數: 2643
2025-08-23 00:23:03 DEBUG [SSS.App:1530] 策略列表: ['Single 2', 'single_1887', 'Single 3', 'RMA_69', 'RMA_669', 'STM0', 'STM1', 'STM3', 'STM4', 'STM_1939', 'STM_2414_273', 'Ensemble_Majority', 'Ensemble_Proportional']
2025-08-23 00:23:04 INFO [SSS.App:1171] [Ensemble_Majority] ⚪ 全局風險閥門未啟用
2025-08-23 00:23:04 INFO [SSS.App:1196] [Ensemble] 執行成功: 權益曲線長度=2643, 交易數=217
2025-08-23 00:23:04 INFO [SSS.App:1211] [Ensemble] 執行完成，ticker=00631L.TW, method=majority
2025-08-23 00:23:04 INFO [SSS.App:843] [Ensemble_Proportional] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:23:04 INFO [SSS.App:888] [Ensemble_Proportional] 未啟用全局風險閥門
2025-08-23 00:23:04 INFO [SSS.App:1062] [Ensemble] 強制設定 majority_k_pct=0.55
2025-08-23 00:23:04 INFO [SSS.App:1064] [Ensemble] 執行配置: ticker=00631L.TW, method=proportional, majority_k_pct=N/A
2025-08-23 00:23:04 INFO [SSS.App:1074] [Ensemble_Proportional] Ensemble ATR 計算: atr_20=<class 'pandas.core.series.Series'>, atr_60=<class 'pandas.core.series.Series'>
2025-08-23 00:23:04 INFO [SSS.App:1080] [Ensemble_Proportional] Ensemble ATR 有效值: atr_20=2624, atr_60=2584
2025-08-23 00:23:04 INFO [SSS.App:1086] [Ensemble_Proportional] Ensemble ATR 最新值: a20=5.957500, a60=5.353334
2025-08-23 00:23:04 INFO [SSS.App:1091] [Ensemble_Proportional] Ensemble ATR 比值: 1.1129 (門檻=1) -> 觸發=True
2025-08-23 00:23:04 INFO [SSS.App:1095] [Ensemble_Proportional] 🔴 風險閥門觸發！ATR比值(1.1129) > 門檻(1)
2025-08-23 00:23:06 INFO [SSS.App:1124] [Ensemble_Proportional] 🔴 開始套用風險閥門: cap=0.3, ratio=1.1129
2025-08-23 00:23:07 INFO [SSS.App:1145] [Ensemble_Proportional] 風險閥門已套用（cap=0.3, ratio=1.1129）
2025-08-23 00:23:07 INFO [SSS.App:1149] [Ensemble_Proportional] 風險閥門效果: PF原始=0.98, PF閥門=1.02
2025-08-23 00:23:07 INFO [SSS.App:1150] [Ensemble_Proportional] 風險閥門效果: MDD原始=-0.36%, MDD閥門=-0.31%
2025-08-23 00:23:07 INFO [SSS.App:1196] [Ensemble] 執行成功: 權益曲線長度=2643, 交易數=393
2025-08-23 00:23:07 INFO [SSS.App:1211] [Ensemble] 執行完成，ticker=00631L.TW, method=proportional
2025-08-23 00:23:07 INFO [SSS.App:1312] [Ensemble_Proportional] 進階分析風險閥門：斜率條件啟用，ATR比值門檻=1
2025-08-23 00:23:07 INFO [SSS.App:1392] [Ensemble_Proportional] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.0
2025-08-23 00:23:09 INFO [SSS.App:1401] [UI_CHECK] 即將覆寫：new_trades=393 rows, new_ds=2643 rows
2025-08-23 00:23:09 INFO [SSS.App:1502] [Ensemble_Proportional] 全局風險閥門已套用（逐日），風險天數=247, CAP=0.30
2025-08-23 00:23:09 INFO [SSS.App:1529] 回測完成 - 策略數: 13, ticker: 00631L.TW, 數據行數: 2643
2025-08-23 00:23:09 DEBUG [SSS.App:1530] 策略列表: ['Single 2', 'single_1887', 'Single 3', 'RMA_69', 'RMA_669', 'STM0', 'STM1', 'STM3', 'STM4', 'STM_1939', 'STM_2414_273', 'Ensemble_Majority', 'Ensemble_Proportional']
2025-08-23 00:23:09 DEBUG [SSS.App:1544] update_tab 被調用 - tab: backtest, strategy: Single 2
2025-08-23 00:23:09 DEBUG [SSS.App:1556] 數據解析完成 - 策略數: 13, ticker: 00631L.TW, 數據行數: 2643
2025-08-23 00:23:09 INFO [SSS.App:1624] [UI] Single 2 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:23:09 INFO [SSS.App:1625] [UI] Single 2 讀取後前 3 列 w: [0.0, 0.0, 0.9998878661]
2025-08-23 00:23:09 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:23:09 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:23:09 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:23:11 INFO [SSS.App:1171] [Ensemble_Proportional] ⚪ 全局風險閥門未啟用
2025-08-23 00:23:11 INFO [SSS.App:1196] [Ensemble] 執行成功: 權益曲線長度=2643, 交易數=390
2025-08-23 00:23:11 INFO [SSS.App:1211] [Ensemble] 執行完成，ticker=00631L.TW, method=proportional
2025-08-23 00:23:11 INFO [SSS.App:1529] 回測完成 - 策略數: 13, ticker: 00631L.TW, 數據行數: 2643
2025-08-23 00:23:11 DEBUG [SSS.App:1530] 策略列表: ['Single 2', 'single_1887', 'Single 3', 'RMA_69', 'RMA_669', 'STM0', 'STM1', 'STM3', 'STM4', 'STM_1939', 'STM_2414_273', 'Ensemble_Majority', 'Ensemble_Proportional']
2025-08-23 00:23:11 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:23:11 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:23:11 INFO [SSS.App:1797] [UI] daily_state_display head=
               equity       cash
2015-07-15  1000000.0  1000000.0
2015-07-16  1000000.0  1000000.0
2015-07-17  1000000.0  1000000.0
2025-08-23 00:23:11 INFO [SSS.App:1798] [UI] trade_df cols=['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price'] head=
        date  type       open  ...   equity_after  trade_date      price
0 2016-04-06   buy  19.660000  ...  969057.630499  2016-04-06  19.660000
1 2016-05-09  sell  17.540001  ...  886054.322650  2016-05-09  17.540001
2 2016-05-17   buy  17.280001  ...  890290.751933  2016-05-17  17.280001

[3 rows x 12 columns]
2025-08-23 00:23:12 INFO [SSS.App:1624] [UI] single_1887 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:23:12 INFO [SSS.App:1625] [UI] single_1887 讀取後前 3 列 w: [0.0, 0.0, 0.9998878661]
2025-08-23 00:23:12 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:23:12 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:23:12 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:23:12 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:23:12 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:23:12 INFO [SSS.App:1797] [UI] daily_state_display head=
               equity       cash
2015-07-15  1000000.0  1000000.0
2015-07-16  1000000.0  1000000.0
2015-07-17  1000000.0  1000000.0
2025-08-23 00:23:12 INFO [SSS.App:1798] [UI] trade_df cols=['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price'] head=
        date  type       open  ...   equity_after  trade_date      price
0 2016-04-06   buy  19.660000  ...  969057.630499  2016-04-06  19.660000
1 2016-05-05  sell  17.650000  ...  891610.459984  2016-05-05  17.650000
2 2016-05-17   buy  17.280001  ...  895873.207985  2016-05-17  17.280001

[3 rows x 12 columns]
2025-08-23 00:23:12 INFO [SSS.App:1624] [UI] Single 3 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:23:12 INFO [SSS.App:1625] [UI] Single 3 讀取後前 3 列 w: [0.0, 0.0, 0.9998878661]
2025-08-23 00:23:12 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:23:12 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:23:12 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:23:12 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:23:12 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:23:12 INFO [SSS.App:1797] [UI] daily_state_display head=
               equity       cash
2015-07-15  1000000.0  1000000.0
2015-07-16  1000000.0  1000000.0
2015-07-17  1000000.0  1000000.0
2025-08-23 00:23:12 INFO [SSS.App:1798] [UI] trade_df cols=['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price'] head=
        date  type       open  ...  equity_after  trade_date      price
0 2016-04-06   buy  19.660000  ...  9.690576e+05  2016-04-06  19.660000
1 2016-04-20  sell  19.840000  ...  1.002228e+06  2016-04-20  19.840000
2 2016-05-17   buy  17.280001  ...  1.007020e+06  2016-05-17  17.280001

[3 rows x 12 columns]
2025-08-23 00:23:12 INFO [SSS.App:1624] [UI] RMA_69 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:23:12 INFO [SSS.App:1625] [UI] RMA_69 讀取後前 3 列 w: [0.0, 0.0, 0.9998251195000001]
2025-08-23 00:23:12 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:23:12 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:23:12 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:23:12 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:23:12 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:23:12 INFO [SSS.App:1797] [UI] daily_state_display head=
               equity       cash
2016-04-26  1000000.0  1000000.0
2016-04-27  1000000.0  1000000.0
2016-04-28  1000000.0  1000000.0
2025-08-23 00:23:12 INFO [SSS.App:1798] [UI] trade_df cols=['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price'] head=
        date  type       open  ...   equity_after  trade_date      price
0 2017-11-01   buy  37.119999  ...  990953.900581  2017-11-01  37.119999
1 2017-11-23  sell  37.139999  ...  994882.691300  2017-11-23  37.139999
2 2017-11-28   buy  36.270000  ...  985041.251511  2017-11-28  36.270000

[3 rows x 12 columns]
2025-08-23 00:23:12 INFO [SSS.App:1624] [UI] RMA_669 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:23:12 INFO [SSS.App:1625] [UI] RMA_669 讀取後前 3 列 w: [0.0, 0.0, 0.9999908906]
2025-08-23 00:23:12 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:23:12 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:23:12 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:23:12 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:23:12 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:23:12 INFO [SSS.App:1797] [UI] daily_state_display head=
               equity       cash
2016-05-17  1000000.0  1000000.0
2016-05-18  1000000.0  1000000.0
2016-05-19  1000000.0  1000000.0
2025-08-23 00:23:12 INFO [SSS.App:1798] [UI] trade_df cols=['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price'] head=
        date  type       open  ...  equity_after  trade_date      price
0 2017-12-01   buy  35.060001  ...  1.005277e+06  2017-12-01  35.060001
1 2017-12-05  sell  35.099998  ...  9.921937e+05  2017-12-05  35.099998
2 2017-12-08   buy  33.820000  ...  9.887404e+05  2017-12-08  33.820000

[3 rows x 12 columns]
2025-08-23 00:23:12 INFO [SSS.App:1624] [UI] STM0 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:23:12 INFO [SSS.App:1625] [UI] STM0 讀取後前 3 列 w: [0.0, 0.0, 0.0]
2025-08-23 00:23:12 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:23:12 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:23:12 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:23:13 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:23:13 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:23:13 INFO [SSS.App:1797] [UI] daily_state_display head=
               equity       cash
2014-10-23  1000000.0  1000000.0
2014-10-24  1000000.0  1000000.0
2014-10-27  1000000.0  1000000.0
2025-08-23 00:23:13 INFO [SSS.App:1798] [UI] trade_df cols=['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price'] head=
        date  type   open   delta_units  ...  equity_open_after_trade  equity_after  trade_date  price
0 2015-04-17   buy  18.40  54343.742295  ...            999573.032094  1.006094e+06  2015-04-17  18.40
1 2015-05-20  sell  18.17 -54320.680554  ...            980738.652862  9.807387e+05  2015-05-20  18.17
2 2015-06-10   buy  19.00  51612.622059  ...            980319.919659  9.746425e+05  2015-06-10  19.00

[3 rows x 12 columns]
2025-08-23 00:23:13 INFO [SSS.App:1624] [UI] STM1 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:23:13 INFO [SSS.App:1625] [UI] STM1 讀取後前 3 列 w: [0.0, 0.0, 0.0]
2025-08-23 00:23:13 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:23:13 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:23:13 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:23:13 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:23:13 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:23:13 INFO [SSS.App:1797] [UI] daily_state_display head=
               equity       cash
2014-10-23  1000000.0  1000000.0
2014-10-24  1000000.0  1000000.0
2014-10-27  1000000.0  1000000.0
2025-08-23 00:23:13 INFO [SSS.App:1798] [UI] trade_df cols=['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price'] head=
        date  type       open  ...  equity_after  trade_date      price
0 2015-06-12   buy  18.950001  ...  1.001684e+06  2015-06-12  18.950001
1 2015-06-22  sell  19.030001  ...  9.973428e+05  2015-06-22  19.030001
2 2015-08-21   buy  21.500000  ...  7.278743e+05  2015-08-21  21.500000

[3 rows x 12 columns]
2025-08-23 00:23:13 INFO [SSS.App:1624] [UI] STM3 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:23:13 INFO [SSS.App:1625] [UI] STM3 讀取後前 3 列 w: [0.0, 0.0, 0.0]
2025-08-23 00:23:13 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:23:13 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:23:13 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:23:13 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:23:13 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:23:13 INFO [SSS.App:1797] [UI] daily_state_display head=
               equity       cash
2014-10-23  1000000.0  1000000.0
2014-10-24  1000000.0  1000000.0
2014-10-27  1000000.0  1000000.0
2025-08-23 00:23:13 INFO [SSS.App:1798] [UI] trade_df cols=['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price'] head=
        date  type       open  ...  equity_after  trade_date      price
0 2015-06-12   buy  18.950001  ...  1.001684e+06  2015-06-12  18.950001
1 2015-06-26  sell  18.590000  ...  9.742863e+05  2015-06-26  18.590000
2 2015-09-10   buy  18.049999  ...  9.754570e+05  2015-09-10  18.049999

[3 rows x 12 columns]
2025-08-23 00:23:13 INFO [SSS.App:1624] [UI] STM4 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:23:13 INFO [SSS.App:1625] [UI] STM4 讀取後前 3 列 w: [0.0, 0.0, 0.0]
2025-08-23 00:23:13 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:23:13 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:23:13 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:23:13 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:23:13 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:23:13 INFO [SSS.App:1797] [UI] daily_state_display head=
               equity       cash
2014-10-23  1000000.0  1000000.0
2014-10-24  1000000.0  1000000.0
2014-10-27  1000000.0  1000000.0
2025-08-23 00:23:13 INFO [SSS.App:1798] [UI] trade_df cols=['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price'] head=
        date  type       open  ...  equity_after  trade_date      price
0 2015-02-25   buy  18.309999  ...  1.000200e+06  2015-02-25  18.309999
1 2015-03-11   buy  18.700001  ...  1.000013e+06  2015-03-11  18.700001
2 2015-04-10  sell  18.360001  ...  9.812932e+05  2015-04-10  18.360001

[3 rows x 12 columns]
2025-08-23 00:23:13 INFO [SSS.App:1624] [UI] STM_1939 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:23:13 INFO [SSS.App:1625] [UI] STM_1939 讀取後前 3 列 w: [0.0, 0.0, 0.0]
2025-08-23 00:23:13 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:23:13 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:23:13 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:23:13 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:23:13 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:23:13 INFO [SSS.App:1797] [UI] daily_state_display head=
               equity       cash
2014-10-23  1000000.0  1000000.0
2014-10-24  1000000.0  1000000.0
2014-10-27  1000000.0  1000000.0
2025-08-23 00:23:13 INFO [SSS.App:1798] [UI] trade_df cols=['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price'] head=
        date  type   open   delta_units  ...  equity_open_after_trade  equity_after  trade_date  price
0 2015-12-21   buy  17.59  17055.144821  ...             9.998719e+05  1.006865e+06  2015-12-21  17.59
1 2015-12-25   buy  18.18  38878.697020  ...             1.009601e+06  1.021821e+06  2015-12-25  18.18
2 2016-01-05  sell  17.07 -55527.365598  ...             9.418780e+05  9.418780e+05  2016-01-05  17.07

[3 rows x 12 columns]
2025-08-23 00:23:14 INFO [SSS.App:1624] [UI] STM_2414_273 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:23:14 INFO [SSS.App:1625] [UI] STM_2414_273 讀取後前 3 列 w: [0.0, 0.0, 0.0]
2025-08-23 00:23:14 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:23:14 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:23:14 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:23:14 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:23:14 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:23:14 INFO [SSS.App:1797] [UI] daily_state_display head=
               equity       cash
2014-10-23  1000000.0  1000000.0
2014-10-24  1000000.0  1000000.0
2014-10-27  1000000.0  1000000.0
2025-08-23 00:23:14 INFO [SSS.App:1798] [UI] trade_df cols=['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price'] head=
        date  type       open  ...  equity_after  trade_date      price
0 2015-08-25   buy  14.440000  ...  1.062588e+06  2015-08-25  14.440000
1 2015-08-31  sell  16.650000  ...  1.154657e+06  2015-08-31  16.650000
2 2015-09-16   buy  18.280001  ...  1.203536e+06  2015-09-16  18.280001

[3 rows x 12 columns]
2025-08-23 00:23:14 INFO [SSS.App:1624] [UI] Ensemble_Majority trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:23:14 INFO [SSS.App:1625] [UI] Ensemble_Majority 讀取後前 3 列 w: [0.2, 0.2, 0.2]
2025-08-23 00:23:14 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:23:14 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:23:14 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:23:14 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:23:14 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:23:14 INFO [SSS.App:1797] [UI] daily_state_display head=
               equity       cash
2014-10-23  1000000.0  1000000.0
2014-10-24  1000000.0  1000000.0
2014-10-27  1000000.0  1000000.0
2025-08-23 00:23:14 INFO [SSS.App:1798] [UI] trade_df cols=['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price'] head=
        date type       open  ...   equity_after  trade_date      price
0 2016-05-17  buy  17.280001  ...  990946.409527  2016-05-17  17.280001
1 2016-05-18  buy  17.370001  ...  998578.177736  2016-05-18  17.370001
2 2016-05-19  buy  17.540001  ...  990849.710723  2016-05-19  17.540001

[3 rows x 12 columns]
2025-08-23 00:23:14 INFO [SSS.App:1624] [UI] Ensemble_Proportional trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:23:14 INFO [SSS.App:1625] [UI] Ensemble_Proportional 讀取後前 3 列 w: [0.2, 0.2, 0.2]
2025-08-23 00:23:14 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:23:14 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:23:14 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:23:14 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:23:14 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:23:14 INFO [SSS.App:1797] [UI] daily_state_display head=
               equity       cash
2014-10-23  1000000.0  1000000.0
2014-10-24  1000000.0  1000000.0
2014-10-27  1000000.0  1000000.0
2025-08-23 00:23:14 INFO [SSS.App:1798] [UI] trade_df cols=['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price'] head=
        date type       open  ...   equity_after  trade_date      price
0 2015-08-31  buy  16.650000  ...  980006.502974  2015-08-31  16.650000
1 2015-09-02  buy  16.190001  ...  985877.748609  2015-09-02  16.190001
2 2015-09-07  buy  16.660000  ...  978512.184019  2015-09-07  16.660000

[3 rows x 12 columns]
2025-08-23 00:26:38 INFO [SSS.App:620] === 風險閥門狀態更新 ===
2025-08-23 00:26:38 INFO [SSS.App:621] global_apply: False
2025-08-23 00:26:38 INFO [SSS.App:622] risk_cap: 0.3
2025-08-23 00:26:38 INFO [SSS.App:623] atr_ratio: 1
2025-08-23 00:26:38 INFO [SSS.App:624] force_trigger: False
2025-08-23 00:26:38 INFO [SSS.App:625] ticker: 00631L.TW
2025-08-23 00:26:38 INFO [SSS.App:626] start_date: 2010-01-01
2025-08-23 00:26:38 INFO [SSS.App:627] end_date: 
2025-08-23 00:26:38 INFO [SSS.App:630] 風險閥門未啟用
2025-08-23 00:26:39 DEBUG [SSS.App:805] run_backtest 被調用 - n_clicks: 0, auto_run: True, trigger: global-apply-switch
2025-08-23 00:26:39 INFO [SSS.App:826] 開始執行回測 - ticker: 00631L.TW, 策略數: 13
2025-08-23 00:26:39 INFO [SSS.App:843] [Single 2] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:26:39 INFO [SSS.App:888] [Single 2] 未啟用全局風險閥門
2025-08-23 00:26:39 INFO [SSS.App:843] [single_1887] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:26:39 INFO [SSS.App:888] [single_1887] 未啟用全局風險閥門
2025-08-23 00:26:39 INFO [SSS.App:843] [Single 3] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:26:39 INFO [SSS.App:888] [Single 3] 未啟用全局風險閥門
2025-08-23 00:26:40 INFO [SSS.App:843] [RMA_69] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:26:40 INFO [SSS.App:888] [RMA_69] 未啟用全局風險閥門
2025-08-23 00:26:40 INFO [SSS.App:843] [RMA_669] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:26:40 INFO [SSS.App:888] [RMA_669] 未啟用全局風險閥門
2025-08-23 00:26:40 INFO [SSS.App:843] [STM0] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:26:40 INFO [SSS.App:888] [STM0] 未啟用全局風險閥門
2025-08-23 00:26:41 INFO [SSS.App:843] [STM1] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:26:41 INFO [SSS.App:888] [STM1] 未啟用全局風險閥門
2025-08-23 00:26:41 INFO [SSS.App:843] [STM3] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:26:41 INFO [SSS.App:888] [STM3] 未啟用全局風險閥門
2025-08-23 00:26:41 INFO [SSS.App:843] [STM4] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:26:41 INFO [SSS.App:888] [STM4] 未啟用全局風險閥門
2025-08-23 00:26:42 INFO [SSS.App:843] [STM_1939] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:26:42 INFO [SSS.App:888] [STM_1939] 未啟用全局風險閥門
2025-08-23 00:26:42 INFO [SSS.App:843] [STM_2414_273] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:26:42 INFO [SSS.App:888] [STM_2414_273] 未啟用全局風險閥門
2025-08-23 00:26:42 INFO [SSS.App:843] [Ensemble_Majority] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:26:42 INFO [SSS.App:888] [Ensemble_Majority] 未啟用全局風險閥門
2025-08-23 00:26:42 INFO [SSS.App:1062] [Ensemble] 強制設定 majority_k_pct=0.55
2025-08-23 00:26:42 INFO [SSS.App:1064] [Ensemble] 執行配置: ticker=00631L.TW, method=majority, majority_k_pct=N/A
2025-08-23 00:26:42 INFO [SSS.App:1074] [Ensemble_Majority] Ensemble ATR 計算: atr_20=<class 'pandas.core.series.Series'>, atr_60=<class 'pandas.core.series.Series'>
2025-08-23 00:26:42 INFO [SSS.App:1080] [Ensemble_Majority] Ensemble ATR 有效值: atr_20=2624, atr_60=2584
2025-08-23 00:26:42 INFO [SSS.App:1086] [Ensemble_Majority] Ensemble ATR 最新值: a20=5.957500, a60=5.353334
2025-08-23 00:26:42 INFO [SSS.App:1091] [Ensemble_Majority] Ensemble ATR 比值: 1.1129 (門檻=1) -> 觸發=True
2025-08-23 00:26:42 INFO [SSS.App:1095] [Ensemble_Majority] 🔴 風險閥門觸發！ATR比值(1.1129) > 門檻(1)
2025-08-23 00:26:44 INFO [SSS.App:1171] [Ensemble_Majority] ⚪ 全局風險閥門未啟用
2025-08-23 00:26:44 INFO [SSS.App:1196] [Ensemble] 執行成功: 權益曲線長度=2643, 交易數=217
2025-08-23 00:26:44 INFO [SSS.App:1211] [Ensemble] 執行完成，ticker=00631L.TW, method=majority
2025-08-23 00:26:44 INFO [SSS.App:843] [Ensemble_Proportional] 風險閥門開關狀態: global_apply=False, 類型=<class 'bool'>
2025-08-23 00:26:44 INFO [SSS.App:888] [Ensemble_Proportional] 未啟用全局風險閥門
2025-08-23 00:26:44 INFO [SSS.App:1062] [Ensemble] 強制設定 majority_k_pct=0.55
2025-08-23 00:26:44 INFO [SSS.App:1064] [Ensemble] 執行配置: ticker=00631L.TW, method=proportional, majority_k_pct=N/A
2025-08-23 00:26:44 INFO [SSS.App:1074] [Ensemble_Proportional] Ensemble ATR 計算: atr_20=<class 'pandas.core.series.Series'>, atr_60=<class 'pandas.core.series.Series'>
2025-08-23 00:26:44 INFO [SSS.App:1080] [Ensemble_Proportional] Ensemble ATR 有效值: atr_20=2624, atr_60=2584
2025-08-23 00:26:44 INFO [SSS.App:1086] [Ensemble_Proportional] Ensemble ATR 最新值: a20=5.957500, a60=5.353334
2025-08-23 00:26:44 INFO [SSS.App:1091] [Ensemble_Proportional] Ensemble ATR 比值: 1.1129 (門檻=1) -> 觸發=True
2025-08-23 00:26:44 INFO [SSS.App:1095] [Ensemble_Proportional] 🔴 風險閥門觸發！ATR比值(1.1129) > 門檻(1)
2025-08-23 00:26:46 INFO [SSS.App:1171] [Ensemble_Proportional] ⚪ 全局風險閥門未啟用
2025-08-23 00:26:46 INFO [SSS.App:1196] [Ensemble] 執行成功: 權益曲線長度=2643, 交易數=390
2025-08-23 00:26:46 INFO [SSS.App:1211] [Ensemble] 執行完成，ticker=00631L.TW, method=proportional
2025-08-23 00:26:46 INFO [SSS.App:1529] 回測完成 - 策略數: 13, ticker: 00631L.TW, 數據行數: 2643
2025-08-23 00:26:46 DEBUG [SSS.App:1530] 策略列表: ['Single 2', 'single_1887', 'Single 3', 'RMA_69', 'RMA_669', 'STM0', 'STM1', 'STM3', 'STM4', 'STM_1939', 'STM_2414_273', 'Ensemble_Majority', 'Ensemble_Proportional']
2025-08-23 00:26:46 DEBUG [SSS.App:1544] update_tab 被調用 - tab: backtest, strategy: Single 2
2025-08-23 00:26:46 DEBUG [SSS.App:1556] 數據解析完成 - 策略數: 13, ticker: 00631L.TW, 數據行數: 2643
2025-08-23 00:26:46 INFO [SSS.App:1624] [UI] Single 2 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:26:46 INFO [SSS.App:1625] [UI] Single 2 讀取後前 3 列 w: [0.0, 0.0, 0.9998878661]
2025-08-23 00:26:46 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['signal_date', 'trade_date', 'type', 'price', 'shares', 'return']
2025-08-23 00:26:46 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['signal_date', 'trade_date', 'type', 'price', 'shares', 'return']
2025-08-23 00:26:46 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：[]
2025-08-23 00:26:46 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'shares', 'w']
2025-08-23 00:26:46 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'shares', 'w']
2025-08-23 00:26:46 INFO [SSS.App:1797] [UI] daily_state_display head=
                   equity           cash
2015-07-15  100000.000000  100000.000000
2015-07-16  100000.000000  100000.000000
2015-07-17  100262.306004      11.242802
2025-08-23 00:26:46 INFO [SSS.App:1798] [UI] trade_df cols=['signal_date', 'trade_date', 'type', 'price', 'shares', 'return'] head=
  signal_date trade_date  type      price  shares    return
0  2015-07-16 2015-07-16   buy  19.059999    5246       NaN
1  2015-08-17 2015-08-17  sell  20.450001    5246  0.069073
2  2015-08-25 2015-08-25   buy  14.440000    7430       NaN
2025-08-23 00:26:46 INFO [SSS.App:1624] [UI] single_1887 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:26:46 INFO [SSS.App:1625] [UI] single_1887 讀取後前 3 列 w: [0.0, 0.0, 0.9998878661]
2025-08-23 00:26:46 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['signal_date', 'trade_date', 'type', 'price', 'shares', 'return']
2025-08-23 00:26:46 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['signal_date', 'trade_date', 'type', 'price', 'shares', 'return']
2025-08-23 00:26:46 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：[]
2025-08-23 00:26:46 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'shares', 'w']
2025-08-23 00:26:46 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'shares', 'w']
2025-08-23 00:26:46 INFO [SSS.App:1797] [UI] daily_state_display head=
                   equity           cash
2015-07-15  100000.000000  100000.000000
2015-07-16  100000.000000  100000.000000
2015-07-17  100262.306004      11.242802
2025-08-23 00:26:46 INFO [SSS.App:1798] [UI] trade_df cols=['signal_date', 'trade_date', 'type', 'price', 'shares', 'return'] head=
  signal_date trade_date  type      price  shares    return
0  2015-07-16 2015-07-16   buy  19.059999    5246       NaN
1  2015-08-13 2015-08-13  sell  20.410000    5246  0.066974
2  2015-08-25 2015-08-25   buy  14.440000    7415       NaN
2025-08-23 00:26:46 INFO [SSS.App:1624] [UI] Single 3 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:26:46 INFO [SSS.App:1625] [UI] Single 3 讀取後前 3 列 w: [0.0, 0.0, 0.9998878661]
2025-08-23 00:26:46 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['signal_date', 'trade_date', 'type', 'price', 'shares', 'return']
2025-08-23 00:26:46 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['signal_date', 'trade_date', 'type', 'price', 'shares', 'return']
2025-08-23 00:26:46 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：[]
2025-08-23 00:26:46 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'shares', 'w']
2025-08-23 00:26:46 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'shares', 'w']
2025-08-23 00:26:46 INFO [SSS.App:1797] [UI] daily_state_display head=
                   equity           cash
2015-07-15  100000.000000  100000.000000
2015-07-16  100000.000000  100000.000000
2015-07-17  100262.306004      11.242802
2025-08-23 00:26:46 INFO [SSS.App:1798] [UI] trade_df cols=['signal_date', 'trade_date', 'type', 'price', 'shares', 'return'] head=
  signal_date trade_date  type      price  shares    return
0  2015-07-16 2015-07-16   buy  19.059999    5246       NaN
1  2015-07-30 2015-07-30  sell  19.920000    5246  0.041266
2  2015-08-25 2015-08-25   buy  14.440000    7237       NaN
2025-08-23 00:26:46 INFO [SSS.App:1624] [UI] RMA_69 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:26:46 INFO [SSS.App:1625] [UI] RMA_69 讀取後前 3 列 w: [0.0, 0.0, 0.9998251195000001]
2025-08-23 00:26:46 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['signal_date', 'trade_date', 'type', 'price', 'shares', 'return']
2025-08-23 00:26:46 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['signal_date', 'trade_date', 'type', 'price', 'shares', 'return']
2025-08-23 00:26:46 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：[]
2025-08-23 00:26:46 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'shares', 'w']
2025-08-23 00:26:46 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'shares', 'w']
2025-08-23 00:26:46 INFO [SSS.App:1797] [UI] daily_state_display head=
                   equity           cash
2016-04-26  100000.000000  100000.000000
2016-04-27  100000.000000  100000.000000
2016-04-28   96474.787271      16.871559
2025-08-23 00:26:46 INFO [SSS.App:1798] [UI] trade_df cols=['signal_date', 'trade_date', 'type', 'price', 'shares', 'return'] head=
  signal_date trade_date  type      price  shares    return
0  2016-04-27 2016-04-27   buy  19.570000    5109       NaN
1  2016-09-26 2016-09-26  sell  24.740000    5109  0.260325
2  2016-11-21 2016-11-21   buy  23.879999    5293       NaN
2025-08-23 00:26:46 INFO [SSS.App:1624] [UI] RMA_669 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:26:46 INFO [SSS.App:1625] [UI] RMA_669 讀取後前 3 列 w: [0.0, 0.0, 0.9999908906]
2025-08-23 00:26:46 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['signal_date', 'trade_date', 'type', 'price', 'shares', 'return']
2025-08-23 00:26:46 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['signal_date', 'trade_date', 'type', 'price', 'shares', 'return']
2025-08-23 00:26:46 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：[]
2025-08-23 00:26:47 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'shares', 'w']
2025-08-23 00:26:47 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'shares', 'w']
2025-08-23 00:26:47 INFO [SSS.App:1797] [UI] daily_state_display head=
                   equity           cash
2016-05-17  100000.000000  100000.000000
2016-05-18  100000.000000  100000.000000
2016-05-19   99366.726486       0.905169
2025-08-23 00:26:47 INFO [SSS.App:1798] [UI] trade_df cols=['signal_date', 'trade_date', 'type', 'price', 'shares', 'return'] head=
  signal_date trade_date  type      price  shares   return
0  2016-05-18 2016-05-18   buy  17.370001    5757      NaN
1  2016-06-29 2016-06-29  sell  19.850000    5757  0.13892
2  2016-08-30 2016-08-30   buy  23.850000    4791      NaN
2025-08-23 00:26:47 INFO [SSS.App:1624] [UI] STM0 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:26:47 INFO [SSS.App:1625] [UI] STM0 讀取後前 3 列 w: [0.0, 0.0, 0.0]
2025-08-23 00:26:47 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['signal_date', 'trade_date', 'type', 'price', 'shares', 'return']
2025-08-23 00:26:47 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['signal_date', 'trade_date', 'type', 'price', 'shares', 'return']
2025-08-23 00:26:47 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：[]
2025-08-23 00:26:47 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'shares', 'w']
2025-08-23 00:26:47 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'shares', 'w']
2025-08-23 00:26:47 INFO [SSS.App:1797] [UI] daily_state_display head=
              equity      cash
2015-04-08  100000.0  100000.0
2015-04-09  100000.0  100000.0
2015-04-10  100000.0  100000.0
2025-08-23 00:26:47 INFO [SSS.App:1798] [UI] trade_df cols=['signal_date', 'trade_date', 'type', 'price', 'shares', 'return'] head=
  signal_date trade_date  type      price  shares    return
0  2015-04-16 2015-04-16   buy  18.500000    5405       NaN
1  2015-05-19 2015-05-19  sell  18.360001    5405 -0.011423
2  2015-06-09 2015-06-09   buy  18.879999    5256       NaN
2025-08-23 00:26:47 INFO [SSS.App:1624] [UI] STM1 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:26:47 INFO [SSS.App:1625] [UI] STM1 讀取後前 3 列 w: [0.0, 0.0, 0.0]
2025-08-23 00:26:47 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['signal_date', 'trade_date', 'type', 'price', 'shares', 'return']
2025-08-23 00:26:47 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['signal_date', 'trade_date', 'type', 'price', 'shares', 'return']
2025-08-23 00:26:47 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：[]
2025-08-23 00:26:47 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'shares', 'w']
2025-08-23 00:26:47 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'shares', 'w']
2025-08-23 00:26:47 INFO [SSS.App:1797] [UI] daily_state_display head=
              equity      cash
2015-01-08  100000.0  100000.0
2015-01-09  100000.0  100000.0
2015-01-12  100000.0  100000.0
2025-08-23 00:26:47 INFO [SSS.App:1798] [UI] trade_df cols=['signal_date', 'trade_date', 'type', 'price', 'shares', 'return'] head=
  signal_date trade_date  type      price  shares   return
0  2015-06-11 2015-06-11   buy  18.889999    5293      NaN
1  2015-06-18 2015-06-18  sell  19.139999    5293  0.00938
2  2015-08-20 2015-08-20   buy  21.209999    4777      NaN
2025-08-23 00:26:47 INFO [SSS.App:1624] [UI] STM3 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:26:47 INFO [SSS.App:1625] [UI] STM3 讀取後前 3 列 w: [0.0, 0.0, 0.0]
2025-08-23 00:26:47 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['signal_date', 'trade_date', 'type', 'price', 'shares', 'return']
2025-08-23 00:26:47 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['signal_date', 'trade_date', 'type', 'price', 'shares', 'return']
2025-08-23 00:26:47 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：[]
2025-08-23 00:26:47 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'shares', 'w']
2025-08-23 00:26:47 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'shares', 'w']
2025-08-23 00:26:47 INFO [SSS.App:1797] [UI] daily_state_display head=
              equity      cash
2015-01-15  100000.0  100000.0
2015-01-16  100000.0  100000.0
2015-01-19  100000.0  100000.0
2025-08-23 00:26:47 INFO [SSS.App:1798] [UI] trade_df cols=['signal_date', 'trade_date', 'type', 'price', 'shares', 'return'] head=
  signal_date trade_date  type      price  shares    return
0  2015-06-11 2015-06-11   buy  18.889999    5293       NaN
1  2015-06-25 2015-06-25  sell  18.700001    5293 -0.013913
2  2015-09-09 2015-09-09   buy  17.420000    5682       NaN
2025-08-23 00:26:47 INFO [SSS.App:1624] [UI] STM4 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:26:47 INFO [SSS.App:1625] [UI] STM4 讀取後前 3 列 w: [0.0, 0.0, 0.0]
2025-08-23 00:26:47 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['signal_date', 'trade_date', 'type', 'price', 'shares', 'return']
2025-08-23 00:26:47 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['signal_date', 'trade_date', 'type', 'price', 'shares', 'return']
2025-08-23 00:26:47 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：[]
2025-08-23 00:26:47 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'shares', 'w']
2025-08-23 00:26:47 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'shares', 'w']
2025-08-23 00:26:47 INFO [SSS.App:1797] [UI] daily_state_display head=
              equity      cash
2014-12-23  100000.0  100000.0
2014-12-24  100000.0  100000.0
2014-12-25  100000.0  100000.0
2025-08-23 00:26:47 INFO [SSS.App:1798] [UI] trade_df cols=['signal_date', 'trade_date', 'type', 'price', 'shares', 'return'] head=
  signal_date trade_date  type      price  shares    return
0  2015-02-24 2015-02-24   buy  18.459999    5417       NaN
1  2015-04-09 2015-04-09  sell  18.510000    5417 -0.001146
2  2015-04-27 2015-04-27   buy  17.770000    5642       NaN
2025-08-23 00:26:47 INFO [SSS.App:1624] [UI] STM_1939 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:26:47 INFO [SSS.App:1625] [UI] STM_1939 讀取後前 3 列 w: [0.0, 0.0, 0.0]
2025-08-23 00:26:47 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['signal_date', 'trade_date', 'type', 'price', 'shares', 'return']
2025-08-23 00:26:47 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['signal_date', 'trade_date', 'type', 'price', 'shares', 'return']
2025-08-23 00:26:47 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：[]
2025-08-23 00:26:47 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'shares', 'w']
2025-08-23 00:26:47 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'shares', 'w']
2025-08-23 00:26:47 INFO [SSS.App:1797] [UI] daily_state_display head=
              equity      cash
2015-11-10  100000.0  100000.0
2015-11-11  100000.0  100000.0
2015-11-12  100000.0  100000.0
2025-08-23 00:26:47 INFO [SSS.App:1798] [UI] trade_df cols=['signal_date', 'trade_date', 'type', 'price', 'shares', 'return'] head=
  signal_date trade_date  type  price  shares    return
0  2015-12-18 2015-12-18   buy  17.82    5611       NaN
1  2016-01-04 2016-01-04  sell  17.92    5611  0.001757
2  2016-01-15 2016-01-15   buy  15.90    6324       NaN
2025-08-23 00:26:47 INFO [SSS.App:1624] [UI] STM_2414_273 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:26:47 INFO [SSS.App:1625] [UI] STM_2414_273 讀取後前 3 列 w: [0.0, 0.0, 0.0]
2025-08-23 00:26:47 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['signal_date', 'trade_date', 'type', 'price', 'shares', 'return']
2025-08-23 00:26:47 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['signal_date', 'trade_date', 'type', 'price', 'shares', 'return']
2025-08-23 00:26:47 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：[]
2025-08-23 00:26:47 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'shares', 'w']
2025-08-23 00:26:47 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'shares', 'w']
2025-08-23 00:26:47 INFO [SSS.App:1797] [UI] daily_state_display head=
              equity      cash
2015-07-27  100000.0  100000.0
2015-07-28  100000.0  100000.0
2015-07-29  100000.0  100000.0
2025-08-23 00:26:47 INFO [SSS.App:1798] [UI] trade_df cols=['signal_date', 'trade_date', 'type', 'price', 'shares', 'return'] head=
  signal_date trade_date  type      price  shares    return
0  2015-08-24 2015-08-24   buy  15.700000    6369       NaN
1  2016-01-07 2016-01-07  sell  16.530001    6369  0.049011
2  2016-01-19 2016-01-19   buy  15.950000    6601       NaN
2025-08-23 00:26:48 INFO [SSS.App:1624] [UI] Ensemble_Majority trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:26:48 INFO [SSS.App:1625] [UI] Ensemble_Majority 讀取後前 3 列 w: [0.2, 0.2, 0.2]
2025-08-23 00:26:48 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['trade_date', 'type', 'price_open', 'weight_change', 'w_before', 'w_after', 'cost', 'price']
2025-08-23 00:26:48 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:26:48 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:26:48 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct', 'debug_residual_eq_minus_pos_cash']
2025-08-23 00:26:48 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct', 'debug_residual_eq_minus_pos_cash']
2025-08-23 00:26:48 INFO [SSS.App:1797] [UI] daily_state_display head=
               equity       cash
2014-10-23  1000000.0  1000000.0
2014-10-24  1000000.0  1000000.0
2014-10-27  1000000.0  1000000.0
2025-08-23 00:26:48 INFO [SSS.App:1798] [UI] trade_df cols=['trade_date', 'type', 'price_open', 'weight_change', 'w_before', 'w_after', 'cost', 'price'] head=
  trade_date type  price_open  weight_change  w_before  w_after      cost      price
0 2016-05-17  buy   17.280001            0.3       0.2      0.5  0.000127  17.280001
1 2016-05-18  buy   17.370001            0.3       0.5      0.8  0.000127  17.370001
2 2016-05-19  buy   17.540001            0.1       0.8      0.9  0.000043  17.540001
2025-08-23 00:26:48 INFO [SSS.App:1624] [UI] Ensemble_Proportional trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:26:48 INFO [SSS.App:1625] [UI] Ensemble_Proportional 讀取後前 3 列 w: [0.2, 0.2, 0.2]
2025-08-23 00:26:48 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['trade_date', 'type', 'price_open', 'weight_change', 'w_before', 'w_after', 'cost', 'price']
2025-08-23 00:26:48 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:26:48 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:26:48 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct', 'debug_residual_eq_minus_pos_cash']
2025-08-23 00:26:48 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct', 'debug_residual_eq_minus_pos_cash']
2025-08-23 00:26:48 INFO [SSS.App:1797] [UI] daily_state_display head=
               equity       cash
2014-10-23  1000000.0  1000000.0
2014-10-24  1000000.0  1000000.0
2014-10-27  1000000.0  1000000.0
2025-08-23 00:26:48 INFO [SSS.App:1798] [UI] trade_df cols=['trade_date', 'type', 'price_open', 'weight_change', 'w_before', 'w_after', 'cost', 'price'] head=
  trade_date type  price_open  weight_change  w_before   w_after      cost      price
0 2015-08-31  buy   16.650000       0.053333  0.200000  0.253333  0.000022  16.650000
1 2015-09-02  buy   16.190001       0.040000  0.253333  0.293333  0.000017  16.190001
2 2015-09-07  buy   16.660000       0.032500  0.293333  0.325833  0.000014  16.660000
2025-08-23 00:30:01 INFO [SSS.App:620] === 風險閥門狀態更新 ===
2025-08-23 00:30:01 INFO [SSS.App:621] global_apply: True
2025-08-23 00:30:01 INFO [SSS.App:622] risk_cap: 0.3
2025-08-23 00:30:01 INFO [SSS.App:623] atr_ratio: 1
2025-08-23 00:30:01 INFO [SSS.App:624] force_trigger: False
2025-08-23 00:30:01 INFO [SSS.App:625] ticker: 00631L.TW
2025-08-23 00:30:01 INFO [SSS.App:626] start_date: 2010-01-01
2025-08-23 00:30:01 INFO [SSS.App:627] end_date: 
2025-08-23 00:30:01 INFO [SSS.App:640] 開始載入數據: ticker=00631L.TW, start_date=2010-01-01, end_date=
2025-08-23 00:30:01 INFO [SSS.App:642] 數據載入結果: 空=False, 形狀=(2643, 5)
2025-08-23 00:30:01 INFO [SSS.App:646] 開始計算 ATR 比值
2025-08-23 00:30:01 INFO [SSS.App:649] ATR 計算完成: atr_20=<class 'pandas.core.series.Series'>, atr_60=<class 'pandas.core.series.Series'>
2025-08-23 00:30:01 INFO [SSS.App:696] ATR 比值計算: 5.957500 / 5.353334 = 1.1129
2025-08-23 00:30:01 INFO [SSS.App:697] 風險閥門門檻: 1, 當前比值: 1.1129
2025-08-23 00:30:01 INFO [SSS.App:698] 風險閥門觸發: 是
2025-08-23 00:30:01 INFO [SSS.App:699] 風險閥門狀態: 🔴 觸發
2025-08-23 00:30:01 DEBUG [SSS.App:805] run_backtest 被調用 - n_clicks: 0, auto_run: True, trigger: global-apply-switch
2025-08-23 00:30:01 INFO [SSS.App:826] 開始執行回測 - ticker: 00631L.TW, 策略數: 13
2025-08-23 00:30:01 INFO [SSS.App:843] [Single 2] 風險閥門開關狀態: global_apply=True, 類型=<class 'bool'>
2025-08-23 00:30:01 INFO [SSS.App:845] [Single 2] 應用全局風險閥門: CAP=0.3, ATR比值門檻=1
2025-08-23 00:30:01 INFO [SSS.App:876] [Single 2] 最新ATR比值: 1.1129 (20期:5.9575, 60期:5.3533)
2025-08-23 00:30:02 INFO [SSS.App:1312] [Single 2] 進階分析風險閥門：斜率條件啟用，ATR比值門檻=1
2025-08-23 00:30:02 INFO [SSS.App:1392] [Single 2] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.0
2025-08-23 00:30:03 INFO [SSS.App:1401] [UI_CHECK] 即將覆寫：new_trades=84 rows, new_ds=2467 rows
2025-08-23 00:30:03 INFO [SSS.App:1502] [Single 2] 全局風險閥門已套用（逐日），風險天數=235, CAP=0.30
2025-08-23 00:30:03 INFO [SSS.App:843] [single_1887] 風險閥門開關狀態: global_apply=True, 類型=<class 'bool'>
2025-08-23 00:30:03 INFO [SSS.App:845] [single_1887] 應用全局風險閥門: CAP=0.3, ATR比值門檻=1
2025-08-23 00:30:03 INFO [SSS.App:876] [single_1887] 最新ATR比值: 1.1129 (20期:5.9575, 60期:5.3533)
2025-08-23 00:30:04 INFO [SSS.App:1312] [single_1887] 進階分析風險閥門：斜率條件啟用，ATR比值門檻=1
2025-08-23 00:30:04 INFO [SSS.App:1392] [single_1887] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.0
2025-08-23 00:30:05 INFO [SSS.App:1401] [UI_CHECK] 即將覆寫：new_trades=82 rows, new_ds=2467 rows
2025-08-23 00:30:05 INFO [SSS.App:1502] [single_1887] 全局風險閥門已套用（逐日），風險天數=235, CAP=0.30
2025-08-23 00:30:05 INFO [SSS.App:843] [Single 3] 風險閥門開關狀態: global_apply=True, 類型=<class 'bool'>
2025-08-23 00:30:05 INFO [SSS.App:845] [Single 3] 應用全局風險閥門: CAP=0.3, ATR比值門檻=1
2025-08-23 00:30:05 INFO [SSS.App:876] [Single 3] 最新ATR比值: 1.1129 (20期:5.9575, 60期:5.3533)
2025-08-23 00:30:06 INFO [SSS.App:1312] [Single 3] 進階分析風險閥門：斜率條件啟用，ATR比值門檻=1
2025-08-23 00:30:06 INFO [SSS.App:1392] [Single 3] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.0
2025-08-23 00:30:07 INFO [SSS.App:1401] [UI_CHECK] 即將覆寫：new_trades=74 rows, new_ds=2467 rows
2025-08-23 00:30:07 INFO [SSS.App:1502] [Single 3] 全局風險閥門已套用（逐日），風險天數=235, CAP=0.30
2025-08-23 00:30:07 INFO [SSS.App:843] [RMA_69] 風險閥門開關狀態: global_apply=True, 類型=<class 'bool'>
2025-08-23 00:30:07 INFO [SSS.App:845] [RMA_69] 應用全局風險閥門: CAP=0.3, ATR比值門檻=1
2025-08-23 00:30:07 INFO [SSS.App:876] [RMA_69] 最新ATR比值: 1.1129 (20期:5.9575, 60期:5.3533)
2025-08-23 00:30:08 INFO [SSS.App:1312] [RMA_69] 進階分析風險閥門：斜率條件啟用，ATR比值門檻=1
2025-08-23 00:30:08 INFO [SSS.App:1392] [RMA_69] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.0
2025-08-23 00:30:09 INFO [SSS.App:1401] [UI_CHECK] 即將覆寫：new_trades=45 rows, new_ds=2268 rows
2025-08-23 00:30:09 INFO [SSS.App:1502] [RMA_69] 全局風險閥門已套用（逐日），風險天數=202, CAP=0.30
2025-08-23 00:30:09 INFO [SSS.App:843] [RMA_669] 風險閥門開關狀態: global_apply=True, 類型=<class 'bool'>
2025-08-23 00:30:09 INFO [SSS.App:845] [RMA_669] 應用全局風險閥門: CAP=0.3, ATR比值門檻=1
2025-08-23 00:30:09 INFO [SSS.App:876] [RMA_669] 最新ATR比值: 1.1129 (20期:5.9575, 60期:5.3533)
2025-08-23 00:30:10 INFO [SSS.App:1312] [RMA_669] 進階分析風險閥門：斜率條件啟用，ATR比值門檻=1
2025-08-23 00:30:10 INFO [SSS.App:1392] [RMA_669] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.0
2025-08-23 00:30:11 INFO [SSS.App:1401] [UI_CHECK] 即將覆寫：new_trades=44 rows, new_ds=2261 rows
2025-08-23 00:30:11 INFO [SSS.App:1502] [RMA_669] 全局風險閥門已套用（逐日），風險天數=202, CAP=0.30
2025-08-23 00:30:11 INFO [SSS.App:843] [STM0] 風險閥門開關狀態: global_apply=True, 類型=<class 'bool'>
2025-08-23 00:30:11 INFO [SSS.App:845] [STM0] 應用全局風險閥門: CAP=0.3, ATR比值門檻=1
2025-08-23 00:30:11 INFO [SSS.App:876] [STM0] 最新ATR比值: 1.1129 (20期:5.9575, 60期:5.3533)
2025-08-23 00:30:11 INFO [SSS.App:969] [Global] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.1128579330783364
2025-08-23 00:30:13 INFO [SSS.App:987] [STM0] SSMA 風險閥門已套用（cap=0.3, ratio=1.1129）
2025-08-23 00:30:13 INFO [SSS.App:1312] [STM0] 進階分析風險閥門：斜率條件啟用，ATR比值門檻=1
2025-08-23 00:30:13 INFO [SSS.App:1392] [STM0] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.0
2025-08-23 00:30:14 INFO [SSS.App:1401] [UI_CHECK] 即將覆寫：new_trades=68 rows, new_ds=2643 rows
2025-08-23 00:30:14 INFO [SSS.App:1502] [STM0] 全局風險閥門已套用（逐日），風險天數=247, CAP=0.30
2025-08-23 00:30:14 INFO [SSS.App:843] [STM1] 風險閥門開關狀態: global_apply=True, 類型=<class 'bool'>
2025-08-23 00:30:14 INFO [SSS.App:845] [STM1] 應用全局風險閥門: CAP=0.3, ATR比值門檻=1
2025-08-23 00:30:14 INFO [SSS.App:876] [STM1] 最新ATR比值: 1.1129 (20期:5.9575, 60期:5.3533)
2025-08-23 00:30:15 INFO [SSS.App:969] [Global] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.1128579330783364
2025-08-23 00:30:16 INFO [SSS.App:987] [STM1] SSMA 風險閥門已套用（cap=0.3, ratio=1.1129）
2025-08-23 00:30:16 INFO [SSS.App:1312] [STM1] 進階分析風險閥門：斜率條件啟用，ATR比值門檻=1
2025-08-23 00:30:16 INFO [SSS.App:1392] [STM1] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.0
2025-08-23 00:30:18 INFO [SSS.App:1401] [UI_CHECK] 即將覆寫：new_trades=60 rows, new_ds=2643 rows
2025-08-23 00:30:18 INFO [SSS.App:1502] [STM1] 全局風險閥門已套用（逐日），風險天數=247, CAP=0.30
2025-08-23 00:30:18 INFO [SSS.App:843] [STM3] 風險閥門開關狀態: global_apply=True, 類型=<class 'bool'>
2025-08-23 00:30:18 INFO [SSS.App:845] [STM3] 應用全局風險閥門: CAP=0.3, ATR比值門檻=1
2025-08-23 00:30:18 INFO [SSS.App:876] [STM3] 最新ATR比值: 1.1129 (20期:5.9575, 60期:5.3533)
2025-08-23 00:30:18 INFO [SSS.App:969] [Global] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.1128579330783364
2025-08-23 00:30:19 INFO [SSS.App:987] [STM3] SSMA 風險閥門已套用（cap=0.3, ratio=1.1129）
2025-08-23 00:30:20 INFO [SSS.App:1312] [STM3] 進階分析風險閥門：斜率條件啟用，ATR比值門檻=1
2025-08-23 00:30:20 INFO [SSS.App:1392] [STM3] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.0
2025-08-23 00:30:21 INFO [SSS.App:1401] [UI_CHECK] 即將覆寫：new_trades=67 rows, new_ds=2643 rows
2025-08-23 00:30:21 INFO [SSS.App:1502] [STM3] 全局風險閥門已套用（逐日），風險天數=247, CAP=0.30
2025-08-23 00:30:21 INFO [SSS.App:843] [STM4] 風險閥門開關狀態: global_apply=True, 類型=<class 'bool'>
2025-08-23 00:30:21 INFO [SSS.App:845] [STM4] 應用全局風險閥門: CAP=0.3, ATR比值門檻=1
2025-08-23 00:30:21 INFO [SSS.App:876] [STM4] 最新ATR比值: 1.1129 (20期:5.9575, 60期:5.3533)
2025-08-23 00:30:21 INFO [SSS.App:969] [Global] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.1128579330783364
2025-08-23 00:30:22 INFO [SSS.App:987] [STM4] SSMA 風險閥門已套用（cap=0.3, ratio=1.1129）
2025-08-23 00:30:23 INFO [SSS.App:1312] [STM4] 進階分析風險閥門：斜率條件啟用，ATR比值門檻=1
2025-08-23 00:30:23 INFO [SSS.App:1392] [STM4] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.0
2025-08-23 00:30:24 INFO [SSS.App:1401] [UI_CHECK] 即將覆寫：new_trades=83 rows, new_ds=2643 rows
2025-08-23 00:30:24 INFO [SSS.App:1502] [STM4] 全局風險閥門已套用（逐日），風險天數=247, CAP=0.30
2025-08-23 00:30:24 INFO [SSS.App:843] [STM_1939] 風險閥門開關狀態: global_apply=True, 類型=<class 'bool'>
2025-08-23 00:30:24 INFO [SSS.App:845] [STM_1939] 應用全局風險閥門: CAP=0.3, ATR比值門檻=1
2025-08-23 00:30:24 INFO [SSS.App:876] [STM_1939] 最新ATR比值: 1.1129 (20期:5.9575, 60期:5.3533)
2025-08-23 00:30:25 INFO [SSS.App:969] [Global] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.1128579330783364
2025-08-23 00:30:26 INFO [SSS.App:987] [STM_1939] SSMA 風險閥門已套用（cap=0.3, ratio=1.1129）
2025-08-23 00:30:26 INFO [SSS.App:1312] [STM_1939] 進階分析風險閥門：斜率條件啟用，ATR比值門檻=1
2025-08-23 00:30:26 INFO [SSS.App:1392] [STM_1939] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.0
2025-08-23 00:30:28 INFO [SSS.App:1401] [UI_CHECK] 即將覆寫：new_trades=60 rows, new_ds=2643 rows
2025-08-23 00:30:28 INFO [SSS.App:1502] [STM_1939] 全局風險閥門已套用（逐日），風險天數=247, CAP=0.30
2025-08-23 00:30:28 INFO [SSS.App:843] [STM_2414_273] 風險閥門開關狀態: global_apply=True, 類型=<class 'bool'>
2025-08-23 00:30:28 INFO [SSS.App:845] [STM_2414_273] 應用全局風險閥門: CAP=0.3, ATR比值門檻=1
2025-08-23 00:30:28 INFO [SSS.App:876] [STM_2414_273] 最新ATR比值: 1.1129 (20期:5.9575, 60期:5.3533)
2025-08-23 00:30:28 INFO [SSS.App:969] [Global] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.1128579330783364
2025-08-23 00:30:29 INFO [SSS.App:987] [STM_2414_273] SSMA 風險閥門已套用（cap=0.3, ratio=1.1129）
2025-08-23 00:30:30 INFO [SSS.App:1312] [STM_2414_273] 進階分析風險閥門：斜率條件啟用，ATR比值門檻=1
2025-08-23 00:30:30 INFO [SSS.App:1392] [STM_2414_273] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.0
2025-08-23 00:30:31 INFO [SSS.App:1401] [UI_CHECK] 即將覆寫：new_trades=56 rows, new_ds=2643 rows
2025-08-23 00:30:31 INFO [SSS.App:1502] [STM_2414_273] 全局風險閥門已套用（逐日），風險天數=247, CAP=0.30
2025-08-23 00:30:31 INFO [SSS.App:843] [Ensemble_Majority] 風險閥門開關狀態: global_apply=True, 類型=<class 'bool'>
2025-08-23 00:30:31 INFO [SSS.App:845] [Ensemble_Majority] 應用全局風險閥門: CAP=0.3, ATR比值門檻=1
2025-08-23 00:30:31 INFO [SSS.App:876] [Ensemble_Majority] 最新ATR比值: 1.1129 (20期:5.9575, 60期:5.3533)
2025-08-23 00:30:31 INFO [SSS.App:1062] [Ensemble] 強制設定 majority_k_pct=0.55
2025-08-23 00:30:31 INFO [SSS.App:1064] [Ensemble] 執行配置: ticker=00631L.TW, method=majority, majority_k_pct=N/A
2025-08-23 00:30:31 INFO [SSS.App:1074] [Ensemble_Majority] Ensemble ATR 計算: atr_20=<class 'pandas.core.series.Series'>, atr_60=<class 'pandas.core.series.Series'>
2025-08-23 00:30:31 INFO [SSS.App:1080] [Ensemble_Majority] Ensemble ATR 有效值: atr_20=2624, atr_60=2584
2025-08-23 00:30:31 INFO [SSS.App:1086] [Ensemble_Majority] Ensemble ATR 最新值: a20=5.957500, a60=5.353334
2025-08-23 00:30:31 INFO [SSS.App:1091] [Ensemble_Majority] Ensemble ATR 比值: 1.1129 (門檻=1) -> 觸發=True
2025-08-23 00:30:31 INFO [SSS.App:1095] [Ensemble_Majority] 🔴 風險閥門觸發！ATR比值(1.1129) > 門檻(1)
2025-08-23 00:30:32 INFO [SSS.App:1124] [Ensemble_Majority] 🔴 開始套用風險閥門: cap=0.3, ratio=1.1129
2025-08-23 00:30:34 INFO [SSS.App:1145] [Ensemble_Majority] 風險閥門已套用（cap=0.3, ratio=1.1129）
2025-08-23 00:30:34 INFO [SSS.App:1149] [Ensemble_Majority] 風險閥門效果: PF原始=0.75, PF閥門=0.90
2025-08-23 00:30:34 INFO [SSS.App:1150] [Ensemble_Majority] 風險閥門效果: MDD原始=-0.43%, MDD閥門=-0.24%
2025-08-23 00:30:34 INFO [SSS.App:1196] [Ensemble] 執行成功: 權益曲線長度=2643, 交易數=215
2025-08-23 00:30:34 INFO [SSS.App:1211] [Ensemble] 執行完成，ticker=00631L.TW, method=majority
2025-08-23 00:30:34 INFO [SSS.App:1312] [Ensemble_Majority] 進階分析風險閥門：斜率條件啟用，ATR比值門檻=1
2025-08-23 00:30:34 INFO [SSS.App:1392] [Ensemble_Majority] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.0
2025-08-23 00:30:35 INFO [SSS.App:1401] [UI_CHECK] 即將覆寫：new_trades=215 rows, new_ds=2643 rows
2025-08-23 00:30:35 INFO [SSS.App:1502] [Ensemble_Majority] 全局風險閥門已套用（逐日），風險天數=247, CAP=0.30
2025-08-23 00:30:35 INFO [SSS.App:843] [Ensemble_Proportional] 風險閥門開關狀態: global_apply=True, 類型=<class 'bool'>
2025-08-23 00:30:35 INFO [SSS.App:845] [Ensemble_Proportional] 應用全局風險閥門: CAP=0.3, ATR比值門檻=1
2025-08-23 00:30:35 INFO [SSS.App:876] [Ensemble_Proportional] 最新ATR比值: 1.1129 (20期:5.9575, 60期:5.3533)
2025-08-23 00:30:35 INFO [SSS.App:1062] [Ensemble] 強制設定 majority_k_pct=0.55
2025-08-23 00:30:35 INFO [SSS.App:1064] [Ensemble] 執行配置: ticker=00631L.TW, method=proportional, majority_k_pct=N/A
2025-08-23 00:30:36 INFO [SSS.App:1074] [Ensemble_Proportional] Ensemble ATR 計算: atr_20=<class 'pandas.core.series.Series'>, atr_60=<class 'pandas.core.series.Series'>
2025-08-23 00:30:36 INFO [SSS.App:1080] [Ensemble_Proportional] Ensemble ATR 有效值: atr_20=2624, atr_60=2584
2025-08-23 00:30:36 INFO [SSS.App:1086] [Ensemble_Proportional] Ensemble ATR 最新值: a20=5.957500, a60=5.353334
2025-08-23 00:30:36 INFO [SSS.App:1091] [Ensemble_Proportional] Ensemble ATR 比值: 1.1129 (門檻=1) -> 觸發=True
2025-08-23 00:30:36 INFO [SSS.App:1095] [Ensemble_Proportional] 🔴 風險閥門觸發！ATR比值(1.1129) > 門檻(1)
2025-08-23 00:30:37 INFO [SSS.App:1124] [Ensemble_Proportional] 🔴 開始套用風險閥門: cap=0.3, ratio=1.1129
2025-08-23 00:30:38 INFO [SSS.App:1145] [Ensemble_Proportional] 風險閥門已套用（cap=0.3, ratio=1.1129）
2025-08-23 00:30:38 INFO [SSS.App:1149] [Ensemble_Proportional] 風險閥門效果: PF原始=0.98, PF閥門=1.02
2025-08-23 00:30:38 INFO [SSS.App:1150] [Ensemble_Proportional] 風險閥門效果: MDD原始=-0.36%, MDD閥門=-0.31%
2025-08-23 00:30:38 INFO [SSS.App:1196] [Ensemble] 執行成功: 權益曲線長度=2643, 交易數=393
2025-08-23 00:30:38 INFO [SSS.App:1211] [Ensemble] 執行完成，ticker=00631L.TW, method=proportional
2025-08-23 00:30:39 INFO [SSS.App:1312] [Ensemble_Proportional] 進階分析風險閥門：斜率條件啟用，ATR比值門檻=1
2025-08-23 00:30:39 INFO [SSS.App:1392] [Ensemble_Proportional] 風險閥門配置: cap_level=0.3, atr_ratio_mult=1.0
2025-08-23 00:30:40 INFO [SSS.App:1401] [UI_CHECK] 即將覆寫：new_trades=393 rows, new_ds=2643 rows
2025-08-23 00:30:40 INFO [SSS.App:1502] [Ensemble_Proportional] 全局風險閥門已套用（逐日），風險天數=247, CAP=0.30
2025-08-23 00:30:40 INFO [SSS.App:1529] 回測完成 - 策略數: 13, ticker: 00631L.TW, 數據行數: 2643
2025-08-23 00:30:40 DEBUG [SSS.App:1530] 策略列表: ['Single 2', 'single_1887', 'Single 3', 'RMA_69', 'RMA_669', 'STM0', 'STM1', 'STM3', 'STM4', 'STM_1939', 'STM_2414_273', 'Ensemble_Majority', 'Ensemble_Proportional']
2025-08-23 00:30:41 DEBUG [SSS.App:1544] update_tab 被調用 - tab: backtest, strategy: Single 2
2025-08-23 00:30:41 DEBUG [SSS.App:1556] 數據解析完成 - 策略數: 13, ticker: 00631L.TW, 數據行數: 2643
2025-08-23 00:30:41 INFO [SSS.App:1624] [UI] Single 2 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:30:41 INFO [SSS.App:1625] [UI] Single 2 讀取後前 3 列 w: [0.0, 0.0, 0.9998878661]
2025-08-23 00:30:41 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:30:41 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:30:41 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:30:41 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:30:41 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:30:41 INFO [SSS.App:1797] [UI] daily_state_display head=
               equity       cash
2015-07-15  1000000.0  1000000.0
2015-07-16  1000000.0  1000000.0
2015-07-17  1000000.0  1000000.0
2025-08-23 00:30:41 INFO [SSS.App:1798] [UI] trade_df cols=['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price'] head=
        date  type       open  ...   equity_after  trade_date      price
0 2016-04-06   buy  19.660000  ...  969057.630499  2016-04-06  19.660000
1 2016-05-09  sell  17.540001  ...  886054.322650  2016-05-09  17.540001
2 2016-05-17   buy  17.280001  ...  890290.751933  2016-05-17  17.280001

[3 rows x 12 columns]
2025-08-23 00:30:41 INFO [SSS.App:1624] [UI] single_1887 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:30:41 INFO [SSS.App:1625] [UI] single_1887 讀取後前 3 列 w: [0.0, 0.0, 0.9998878661]
2025-08-23 00:30:41 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:30:41 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:30:41 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:30:41 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:30:41 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:30:41 INFO [SSS.App:1797] [UI] daily_state_display head=
               equity       cash
2015-07-15  1000000.0  1000000.0
2015-07-16  1000000.0  1000000.0
2015-07-17  1000000.0  1000000.0
2025-08-23 00:30:41 INFO [SSS.App:1798] [UI] trade_df cols=['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price'] head=
        date  type       open  ...   equity_after  trade_date      price
0 2016-04-06   buy  19.660000  ...  969057.630499  2016-04-06  19.660000
1 2016-05-05  sell  17.650000  ...  891610.459984  2016-05-05  17.650000
2 2016-05-17   buy  17.280001  ...  895873.207985  2016-05-17  17.280001

[3 rows x 12 columns]
2025-08-23 00:30:41 INFO [SSS.App:1624] [UI] Single 3 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:30:41 INFO [SSS.App:1625] [UI] Single 3 讀取後前 3 列 w: [0.0, 0.0, 0.9998878661]
2025-08-23 00:30:41 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:30:41 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:30:41 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:30:41 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:30:41 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:30:41 INFO [SSS.App:1797] [UI] daily_state_display head=
               equity       cash
2015-07-15  1000000.0  1000000.0
2015-07-16  1000000.0  1000000.0
2015-07-17  1000000.0  1000000.0
2025-08-23 00:30:41 INFO [SSS.App:1798] [UI] trade_df cols=['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price'] head=
        date  type       open  ...  equity_after  trade_date      price
0 2016-04-06   buy  19.660000  ...  9.690576e+05  2016-04-06  19.660000
1 2016-04-20  sell  19.840000  ...  1.002228e+06  2016-04-20  19.840000
2 2016-05-17   buy  17.280001  ...  1.007020e+06  2016-05-17  17.280001

[3 rows x 12 columns]
2025-08-23 00:30:42 INFO [SSS.App:1624] [UI] RMA_69 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:30:42 INFO [SSS.App:1625] [UI] RMA_69 讀取後前 3 列 w: [0.0, 0.0, 0.9998251195000001]
2025-08-23 00:30:42 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:30:42 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:30:42 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:30:42 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:30:42 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:30:42 INFO [SSS.App:1797] [UI] daily_state_display head=
               equity       cash
2016-04-26  1000000.0  1000000.0
2016-04-27  1000000.0  1000000.0
2016-04-28  1000000.0  1000000.0
2025-08-23 00:30:42 INFO [SSS.App:1798] [UI] trade_df cols=['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price'] head=
        date  type       open  ...   equity_after  trade_date      price
0 2017-11-01   buy  37.119999  ...  990953.900581  2017-11-01  37.119999
1 2017-11-23  sell  37.139999  ...  994882.691300  2017-11-23  37.139999
2 2017-11-28   buy  36.270000  ...  985041.251511  2017-11-28  36.270000

[3 rows x 12 columns]
2025-08-23 00:30:42 INFO [SSS.App:1624] [UI] RMA_669 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:30:42 INFO [SSS.App:1625] [UI] RMA_669 讀取後前 3 列 w: [0.0, 0.0, 0.9999908906]
2025-08-23 00:30:42 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:30:42 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:30:42 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:30:42 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:30:42 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:30:42 INFO [SSS.App:1797] [UI] daily_state_display head=
               equity       cash
2016-05-17  1000000.0  1000000.0
2016-05-18  1000000.0  1000000.0
2016-05-19  1000000.0  1000000.0
2025-08-23 00:30:42 INFO [SSS.App:1798] [UI] trade_df cols=['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price'] head=
        date  type       open  ...  equity_after  trade_date      price
0 2017-12-01   buy  35.060001  ...  1.005277e+06  2017-12-01  35.060001
1 2017-12-05  sell  35.099998  ...  9.921937e+05  2017-12-05  35.099998
2 2017-12-08   buy  33.820000  ...  9.887404e+05  2017-12-08  33.820000

[3 rows x 12 columns]
2025-08-23 00:30:42 INFO [SSS.App:1624] [UI] STM0 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:30:42 INFO [SSS.App:1625] [UI] STM0 讀取後前 3 列 w: [0.0, 0.0, 0.0]
2025-08-23 00:30:42 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:30:42 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:30:42 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:30:42 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:30:42 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:30:42 INFO [SSS.App:1797] [UI] daily_state_display head=
               equity       cash
2014-10-23  1000000.0  1000000.0
2014-10-24  1000000.0  1000000.0
2014-10-27  1000000.0  1000000.0
2025-08-23 00:30:42 INFO [SSS.App:1798] [UI] trade_df cols=['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price'] head=
        date  type   open   delta_units  ...  equity_open_after_trade  equity_after  trade_date  price
0 2015-04-17   buy  18.40  54343.742295  ...            999573.032094  1.006094e+06  2015-04-17  18.40
1 2015-05-20  sell  18.17 -54320.680554  ...            980738.652862  9.807387e+05  2015-05-20  18.17
2 2015-06-10   buy  19.00  51612.622059  ...            980319.919659  9.746425e+05  2015-06-10  19.00

[3 rows x 12 columns]
2025-08-23 00:30:42 INFO [SSS.App:1624] [UI] STM1 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:30:42 INFO [SSS.App:1625] [UI] STM1 讀取後前 3 列 w: [0.0, 0.0, 0.0]
2025-08-23 00:30:42 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:30:42 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:30:42 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:30:42 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:30:42 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:30:42 INFO [SSS.App:1797] [UI] daily_state_display head=
               equity       cash
2014-10-23  1000000.0  1000000.0
2014-10-24  1000000.0  1000000.0
2014-10-27  1000000.0  1000000.0
2025-08-23 00:30:42 INFO [SSS.App:1798] [UI] trade_df cols=['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price'] head=
        date  type       open  ...  equity_after  trade_date      price
0 2015-06-12   buy  18.950001  ...  1.001684e+06  2015-06-12  18.950001
1 2015-06-22  sell  19.030001  ...  9.973428e+05  2015-06-22  19.030001
2 2015-08-21   buy  21.500000  ...  7.278743e+05  2015-08-21  21.500000

[3 rows x 12 columns]
2025-08-23 00:30:42 INFO [SSS.App:1624] [UI] STM3 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:30:42 INFO [SSS.App:1625] [UI] STM3 讀取後前 3 列 w: [0.0, 0.0, 0.0]
2025-08-23 00:30:42 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:30:42 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:30:42 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:30:42 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:30:42 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:30:42 INFO [SSS.App:1797] [UI] daily_state_display head=
               equity       cash
2014-10-23  1000000.0  1000000.0
2014-10-24  1000000.0  1000000.0
2014-10-27  1000000.0  1000000.0
2025-08-23 00:30:42 INFO [SSS.App:1798] [UI] trade_df cols=['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price'] head=
        date  type       open  ...  equity_after  trade_date      price
0 2015-06-12   buy  18.950001  ...  1.001684e+06  2015-06-12  18.950001
1 2015-06-26  sell  18.590000  ...  9.742863e+05  2015-06-26  18.590000
2 2015-09-10   buy  18.049999  ...  9.754570e+05  2015-09-10  18.049999

[3 rows x 12 columns]
2025-08-23 00:30:42 INFO [SSS.App:1624] [UI] STM4 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:30:42 INFO [SSS.App:1625] [UI] STM4 讀取後前 3 列 w: [0.0, 0.0, 0.0]
2025-08-23 00:30:42 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:30:42 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:30:42 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:30:43 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:30:43 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:30:43 INFO [SSS.App:1797] [UI] daily_state_display head=
               equity       cash
2014-10-23  1000000.0  1000000.0
2014-10-24  1000000.0  1000000.0
2014-10-27  1000000.0  1000000.0
2025-08-23 00:30:43 INFO [SSS.App:1798] [UI] trade_df cols=['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price'] head=
        date  type       open  ...  equity_after  trade_date      price
0 2015-02-25   buy  18.309999  ...  1.000200e+06  2015-02-25  18.309999
1 2015-03-11   buy  18.700001  ...  1.000013e+06  2015-03-11  18.700001
2 2015-04-10  sell  18.360001  ...  9.812932e+05  2015-04-10  18.360001

[3 rows x 12 columns]
2025-08-23 00:30:43 INFO [SSS.App:1624] [UI] STM_1939 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:30:43 INFO [SSS.App:1625] [UI] STM_1939 讀取後前 3 列 w: [0.0, 0.0, 0.0]
2025-08-23 00:30:43 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:30:43 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:30:43 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:30:43 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:30:43 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:30:43 INFO [SSS.App:1797] [UI] daily_state_display head=
               equity       cash
2014-10-23  1000000.0  1000000.0
2014-10-24  1000000.0  1000000.0
2014-10-27  1000000.0  1000000.0
2025-08-23 00:30:43 INFO [SSS.App:1798] [UI] trade_df cols=['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price'] head=
        date  type   open   delta_units  ...  equity_open_after_trade  equity_after  trade_date  price
0 2015-12-21   buy  17.59  17055.144821  ...             9.998719e+05  1.006865e+06  2015-12-21  17.59
1 2015-12-25   buy  18.18  38878.697020  ...             1.009601e+06  1.021821e+06  2015-12-25  18.18
2 2016-01-05  sell  17.07 -55527.365598  ...             9.418780e+05  9.418780e+05  2016-01-05  17.07

[3 rows x 12 columns]
2025-08-23 00:30:43 INFO [SSS.App:1624] [UI] STM_2414_273 trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:30:43 INFO [SSS.App:1625] [UI] STM_2414_273 讀取後前 3 列 w: [0.0, 0.0, 0.0]
2025-08-23 00:30:43 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:30:43 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:30:43 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:30:43 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:30:43 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:30:43 INFO [SSS.App:1797] [UI] daily_state_display head=
               equity       cash
2014-10-23  1000000.0  1000000.0
2014-10-24  1000000.0  1000000.0
2014-10-27  1000000.0  1000000.0
2025-08-23 00:30:43 INFO [SSS.App:1798] [UI] trade_df cols=['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price'] head=
        date  type       open  ...  equity_after  trade_date      price
0 2015-08-25   buy  14.440000  ...  1.062588e+06  2015-08-25  14.440000
1 2015-08-31  sell  16.650000  ...  1.154657e+06  2015-08-31  16.650000
2 2015-09-16   buy  18.280001  ...  1.203536e+06  2015-09-16  18.280001

[3 rows x 12 columns]
2025-08-23 00:30:43 INFO [SSS.App:1624] [UI] Ensemble_Majority trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:30:43 INFO [SSS.App:1625] [UI] Ensemble_Majority 讀取後前 3 列 w: [0.2, 0.2, 0.2]
2025-08-23 00:30:43 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:30:43 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:30:43 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:30:43 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:30:43 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:30:43 INFO [SSS.App:1797] [UI] daily_state_display head=
               equity       cash
2014-10-23  1000000.0  1000000.0
2014-10-24  1000000.0  1000000.0
2014-10-27  1000000.0  1000000.0
2025-08-23 00:30:43 INFO [SSS.App:1798] [UI] trade_df cols=['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price'] head=
        date type       open  ...   equity_after  trade_date      price
0 2016-05-17  buy  17.280001  ...  990946.409527  2016-05-17  17.280001
1 2016-05-18  buy  17.370001  ...  998578.177736  2016-05-18  17.370001
2 2016-05-19  buy  17.540001  ...  990849.710723  2016-05-19  17.540001

[3 rows x 12 columns]
2025-08-23 00:30:43 INFO [SSS.App:1624] [UI] Ensemble_Proportional trades 來源優先序：trades -> trades_ui -> trade_df；實際使用=trades
2025-08-23 00:30:43 INFO [SSS.App:1625] [UI] Ensemble_Proportional 讀取後前 3 列 w: [0.2, 0.2, 0.2]
2025-08-23 00:30:43 INFO [SSS.App:1631] 標準化後 trades_ui 欄位: ['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price']
2025-08-23 00:30:43 INFO [SSS.App:1704] [UI] trade_df 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:30:43 INFO [SSS.App:1705] [UI] trade_ledger_std 原始欄位：['date', 'type', 'open', 'delta_units', 'exec_notional', 'fee_buy', 'fee_sell', 'tax', 'shares_before', 'shares_after', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after']
2025-08-23 00:30:43 INFO [SSS.App:1789] [UI] 使用標準化後的 daily_state_std，欄位: ['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:30:43 INFO [SSS.App:1795] [UI] daily_state_display cols=['equity', 'cash', 'position_value', 'w', 'invested_pct', 'cash_pct']
2025-08-23 00:30:43 INFO [SSS.App:1797] [UI] daily_state_display head=
               equity       cash
2014-10-23  1000000.0  1000000.0
2014-10-24  1000000.0  1000000.0
2014-10-27  1000000.0  1000000.0
2025-08-23 00:30:43 INFO [SSS.App:1798] [UI] trade_df cols=['date', 'type', 'open', 'delta_units', 'exec_notional', 'w_before', 'w_after', 'cash_after', 'equity_open_after_trade', 'equity_after', 'trade_date', 'price'] head=
        date type       open  ...   equity_after  trade_date      price
0 2015-08-31  buy  16.650000  ...  980006.502974  2015-08-31  16.650000
1 2015-09-02  buy  16.190001  ...  985877.748609  2015-09-02  16.190001
2 2015-09-07  buy  16.660000  ...  978512.184019  2015-09-07  16.660000

[3 rows x 12 columns]
